'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(g,m,p){g instanceof String&&(g=String(g));for(var q=g.length,l=0;l<q;l++){var H=g[l];if(m.call(p,H,l,g))return{i:l,v:H}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(g,m,p){if(g==Array.prototype||g==Object.prototype)return g;g[m]=p.value;return g};$jscomp.getGlobal=function(g){g=["object"==typeof globalThis&&globalThis,g,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var m=0;m<g.length;++m){var p=g[m];if(p&&p.Math==Math)return p}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(g,m){var p=$jscomp.propertyToPolyfillSymbol[m];if(null==p)return g[m];p=g[p];return void 0!==p?p:g[m]};
$jscomp.polyfill=function(g,m,p,q){m&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(g,m,p,q):$jscomp.polyfillUnisolated(g,m,p,q))};$jscomp.polyfillUnisolated=function(g,m,p,q){p=$jscomp.global;g=g.split(".");for(q=0;q<g.length-1;q++){var l=g[q];if(!(l in p))return;p=p[l]}g=g[g.length-1];q=p[g];m=m(q);m!=q&&null!=m&&$jscomp.defineProperty(p,g,{configurable:!0,writable:!0,value:m})};
$jscomp.polyfillIsolated=function(g,m,p,q){var l=g.split(".");g=1===l.length;q=l[0];q=!g&&q in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var H=0;H<l.length-1;H++){var R=l[H];if(!(R in q))return;q=q[R]}l=l[l.length-1];p=$jscomp.IS_SYMBOL_NATIVE&&"es6"===p?q[l]:null;m=m(p);null!=m&&(g?$jscomp.defineProperty($jscomp.polyfills,l,{configurable:!0,writable:!0,value:m}):m!==p&&($jscomp.propertyToPolyfillSymbol[l]=$jscomp.IS_SYMBOL_NATIVE?$jscomp.global.Symbol(l):$jscomp.POLYFILL_PREFIX+l,l=
$jscomp.propertyToPolyfillSymbol[l],$jscomp.defineProperty(q,l,{configurable:!0,writable:!0,value:m})))};$jscomp.polyfill("Array.prototype.find",function(g){return g?g:function(g,p){return $jscomp.findInternal(this,g,p).v}},"es6","es3");$jscomp.arrayIteratorImpl=function(g){var m=0;return function(){return m<g.length?{done:!1,value:g[m++]}:{done:!0}}};$jscomp.arrayIterator=function(g){return{next:$jscomp.arrayIteratorImpl(g)}};$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(g){if(g)return g;var m=function(g,m){this.$jscomp$symbol$id_=g;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:m})};m.prototype.toString=function(){return this.$jscomp$symbol$id_};var p=0,q=function(g){if(this instanceof q)throw new TypeError("Symbol is not a constructor");return new m("jscomp_symbol_"+(g||"")+"_"+p++,g)};return q},"es6","es3");$jscomp.initSymbolIterator=function(){};
$jscomp.polyfill("Symbol.iterator",function(g){if(g)return g;g=Symbol("Symbol.iterator");for(var m="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),p=0;p<m.length;p++){var q=$jscomp.global[m[p]];"function"===typeof q&&"function"!=typeof q.prototype[g]&&$jscomp.defineProperty(q.prototype,g,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return g},"es6",
"es3");$jscomp.initSymbolAsyncIterator=function(){};$jscomp.iteratorPrototype=function(g){g={next:g};g[Symbol.iterator]=function(){return this};return g};$jscomp.iteratorFromArray=function(g,m){g instanceof String&&(g+="");var p=0,q={next:function(){if(p<g.length){var l=p++;return{value:m(l,g[l]),done:!1}}q.next=function(){return{done:!0,value:void 0}};return q.next()}};q[Symbol.iterator]=function(){return q};return q};
$jscomp.polyfill("Array.prototype.keys",function(g){return g?g:function(){return $jscomp.iteratorFromArray(this,function(g){return g})}},"es6","es3");$jscomp.checkStringArgs=function(g,m,p){if(null==g)throw new TypeError("The 'this' value for String.prototype."+p+" must not be null or undefined");if(m instanceof RegExp)throw new TypeError("First argument to String.prototype."+p+" must not be a regular expression");return g+""};
$jscomp.polyfill("String.prototype.repeat",function(g){return g?g:function(g){var m=$jscomp.checkStringArgs(this,null,"repeat");if(0>g||1342177279<g)throw new RangeError("Invalid count value");g|=0;for(var q="";g;)if(g&1&&(q+=m),g>>>=1)m+=m;return q}},"es6","es3");
(function(g){"object"==typeof exports&&"object"==typeof module?g(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog/dialog"),require("../addon/edit/matchbrackets.js")):"function"==typeof define&&define.amd?define(["../lib/codemirror","../addon/search/searchcursor","../addon/dialog/dialog","../addon/edit/matchbrackets"],g):g(CodeMirror)})(function(g){var m=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",
type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<Del>",type:"keyToKey",toKeys:"x",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",
toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"c",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"VdO",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",
type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"<Ins>",type:"action",action:"toggleOverwrite",context:"insert"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,
toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",
motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,
bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"(",type:"motion",motion:"moveBySentence",motionArgs:{forward:!1}},{keys:")",type:"motion",motion:"moveBySentence",
motionArgs:{forward:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",
motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",
type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},
{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",
motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,
toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:"=",type:"operator",operator:"indentAuto"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",
type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",
motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"expandToLine",motionArgs:{linewise:!0},context:"normal"},
{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},
{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-w>",type:"idle",context:"normal"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",
action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"gi",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"lastEdit"},
context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"gI",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"bol"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",
type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"<C-q>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",
isEdit:!0},{keys:"gJ",type:"action",action:"joinLines",actionArgs:{keepSpaces:!0},isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,
actionArgs:{replace:!0},context:"normal"},{keys:"R",type:"operator",operator:"change",operatorArgs:{linewise:!0,fullLine:!0},context:"visual",exitVisualBlock:!0},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},
{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",
actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"<C-t>",type:"action",action:"indent",actionArgs:{indentRight:!0},context:"insert"},
{keys:"<C-d>",type:"action",action:"indent",actionArgs:{indentRight:!1},context:"insert"},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,
toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],p=m.length,q=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",
shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"nohlsearch",shortName:"noh"},{name:"yank",shortName:"y"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"global",shortName:"g"}],l=g.Pos;g.Vim=function(){function H(a,b){this==g.keyMap.vim&&
(g.rmClass(a.getWrapperElement(),"cm-fat-cursor"),"contenteditable"==a.getOption("inputStyle")&&null!=document.body.style.caretColor&&(Ba(a),a.off("cursorActivity",na),a.state.fatCursorMarks=null,a.getInputField().style.caretColor=""));b&&b.attach==R||(a.setOption("disableInput",!1),a.off("cursorActivity",Ca),g.off(a.getInputField(),"paste",Da(a)),a.state.vim=null)}function R(a,b){this==g.keyMap.vim&&(g.addClass(a.getWrapperElement(),"cm-fat-cursor"),"contenteditable"==a.getOption("inputStyle")&&
null!=document.body.style.caretColor&&(a.state.fatCursorMarks=[],na(a),a.on("cursorActivity",na),a.getInputField().style.caretColor="transparent"));b&&b.attach==R||(a.setOption("disableInput",!0),a.setOption("showCursorWhenSelecting",!1),g.signal(a,"vim-mode-change",{mode:"normal"}),a.on("cursorActivity",Ca),ca(a),g.on(a.getInputField(),"paste",Da(a)))}function na(a){if(a.state.fatCursorMarks){Ba(a);for(var b=a.listSelections(),c=[],d=0;d<b.length;d++){var f=b[d];if(f.empty()){var e=a.getLine(f.anchor.line).length;
f.anchor.ch<e?c.push(a.markText(f.anchor,l(f.anchor.line,f.anchor.ch+1),{className:"cm-fat-cursor-mark"})):c.push(a.markText(l(f.anchor.line,e-1),l(f.anchor.line,e),{className:"cm-fat-cursor-mark"}))}}a.state.fatCursorMarks=c}}function Ba(a){if(a=a.state.fatCursorMarks)for(var b=0;b<a.length;b++)a[b].clear()}function oa(a,b){if(b){if(this[a])return this[a];a=qb(a);if(!a)return!1;var c=g.Vim.findKey(b,a);"function"==typeof c&&g.signal(b,"vim-keypress",a);return c}}function qb(a){if("'"==a.charAt(0))return a.charAt(1);
a=a.split(/-(?!$)/);var b=a[a.length-1];if(1==a.length&&1==a[0].length||2==a.length&&"Shift"==a[0]&&1==b.length)return!1;for(var c=!1,d=0;d<a.length;d++){var f=a[d];f in Ea?a[d]=Ea[f]:c=!0;f in Fa&&(a[d]=Fa[f])}if(!c)return!1;X(b)&&(a[a.length-1]=b.toLowerCase());return"<"+a.join("-")+">"}function Da(a){var b=a.state.vim;b.onPasteFn||(b.onPasteFn=function(){b.insertMode||(a.setCursor(B(a.getCursor(),0,1)),da.enterInsertMode(a,{},b))});return b.onPasteFn}function pa(a,b){for(var c=[],d=a;d<a+b;d++)c.push(String.fromCharCode(d));
return c}function qa(a,b){return b>=a.firstLine()&&b<=a.lastLine()}function X(a){return/^[A-Z]$/.test(a)}function T(a){return/^\s*$/.test(a)}function ra(a,b){for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1}function ea(a,b,c,d,f){if(void 0===b&&!f)throw Error("defaultValue is required unless callback is provided");c||(c="string");N[a]={type:c,defaultValue:b,callback:f};if(d)for(c=0;c<d.length;c++)N[d[c]]=N[a];b&&sa(a,b)}function sa(a,b,c,d){var f=N[a];d=d||{};d=d.scope;if(!f)return Error("Unknown option: "+
a);if("boolean"==f.type){if(b&&!0!==b)return Error("Invalid argument: "+a+"="+b);!1!==b&&(b=!0)}f.callback?("local"!==d&&f.callback(b,void 0),"global"!==d&&c&&f.callback(b,c)):("local"!==d&&(f.value="boolean"==f.type?!!b:b),"global"!==d&&c&&(c.state.vim.options[a]={value:b}))}function U(a,b,c){var d=N[a];c=c||{};c=c.scope;if(!d)return Error("Unknown option: "+a);if(d.callback){a=b&&d.callback(void 0,b);if("global"!==c&&void 0!==a)return a;if("local"!==c)return d.callback()}else return a="global"!==
c&&b&&b.state.vim.options[a],(a||"local"!==c&&d||{}).value}function Ga(){this.latestRegister=void 0;this.isRecording=this.isPlaying=!1;this.replaySearchQueries=[];this.onRecordingDone=void 0;this.lastInsertModeChanges=Ha()}function ca(a){a.state.vim||(a.state.vim={inputState:new fa,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,
lastPastedText:null,sel:{},options:{}});return a.state.vim}function Ia(){n={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:rb(),macroModeState:new Ga,lastCharacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new Ja({}),searchHistoryController:new ta,exCommandHistoryController:new ta};for(var a in N){var b=N[a];b.value=b.defaultValue}}function fa(){this.prefixRepeat=[];this.motionRepeat=[];this.motionArgs=this.motion=this.operatorArgs=this.operator=
null;this.keyBuffer=[];this.registerName=null}function E(a,b){a.state.vim.inputState=new fa;g.signal(a,"vim-command-done",b)}function I(a,b,c){this.clear();this.keyBuffer=[a||""];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!!b;this.blockwise=!!c}function Ja(a){this.registers=a;this.unnamedRegister=a['"']=new I;a["."]=new I;a[":"]=new I;a["/"]=new I}function ta(){this.historyBuffer=[];this.iterator=0;this.initialPrefix=null}function Ka(a,b){for(var c=[],d=0;d<b;d++)c.push(a);return c}
function D(a,b){var c=a.state.vim,d=c.insertMode||c.visualMode;c=Math.min(Math.max(a.firstLine(),b.line),a.lastLine());a=C(a,c)-1+!!d;return l(c,Math.min(Math.max(0,b.ch),a))}function ha(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function B(a,b,c){"object"===typeof b&&(c=b.ch,b=b.line);return l(a.line+b,a.ch+c)}function La(a,b,c){return function(){for(var d=0;d<c;d++)b(a)}}function x(a){return l(a.line,a.ch)}function J(a,b){return a.ch==b.ch&&a.line==b.line}function z(a,b){return a.line<
b.line||a.line==b.line&&a.ch<b.ch?!0:!1}function F(a,b){2<arguments.length&&(b=F.apply(void 0,Array.prototype.slice.call(arguments,1)));return z(a,b)?a:b}function V(a,b){2<arguments.length&&(b=V.apply(void 0,Array.prototype.slice.call(arguments,1)));return z(a,b)?b:a}function Ma(a,b,c){a=z(a,b);b=z(b,c);return a&&b}function C(a,b){return a.getLine(b).length}function ua(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function sb(a,b,c){var d=C(a,b);c=Array(c-d+1).join(" ");a.setCursor(l(b,d));
a.replaceRange(c,a.getCursor())}function Na(a,b){var c=[],d=a.listSelections(),f=x(a.clipPos(b)),e=!J(b,f),k;a:{var u=a.getCursor("head");for(k=0;k<d.length;k++){var h=J(d[k].anchor,u),w=J(d[k].head,u);if(h||w)break a}k=-1}u=J(d[k].head,d[k].anchor);h=d.length-1;var g=h-k>k?h:0;k=d[g].anchor;var G=Math.min(k.line,f.line);h=Math.max(k.line,f.line);w=k.ch;f=f.ch;d=d[g].head.ch-w;g=f-w;0<d&&0>=g?(w++,e||f--):0>d&&0<=g?(w--,u||f++):0>d&&-1==g&&(w--,f++);for(e=G;e<=h;e++)d={anchor:new l(e,w),head:new l(e,
f)},c.push(d);a.setSelections(c);b.ch=f;k.ch=w;return k}function Oa(a,b,c){for(var d=[],f=0;f<c;f++){var e=B(b,f,0);d.push({anchor:e,head:e})}a.setSelections(d,0)}function tb(a,b){var c=b.lastSelection,d=function(){var b=a.listSelections(),c=b[0];b=b[b.length-1];c=z(c.anchor,c.head)?c.anchor:c.head;b=z(b.anchor,b.head)?b.head:b.anchor;return[c,b]},f=function(){var b=a.getCursor(),d=a.getCursor(),f=c.visualBlock;if(f){d=l(b.line+f.height,b.ch+f.width);f=[];for(var h=b.line;h<d.line;h++){var g=l(h,
b.ch),A=l(h,d.ch);f.push({anchor:g,head:A})}a.setSelections(f)}else h=c.anchorMark.find(),g=c.headMark.find(),f=g.line-h.line,h=g.ch-h.ch,d={line:d.line+f,ch:f?d.ch:h+d.ch},c.visualLine&&(b=l(b.line,0),d=l(d.line,C(a,d.line))),a.setSelection(b,d);return[b,d]};return b.visualMode?d():f()}function Pa(a,b){var c=b.sel.anchor,d=b.sel.head;b.lastPastedText&&(d=a.posFromIndex(a.indexFromPos(c)+b.lastPastedText.length),b.lastPastedText=null);b.lastSelection={anchorMark:a.setBookmark(c),headMark:a.setBookmark(d),
anchor:x(c),head:x(d),visualMode:b.visualMode,visualLine:b.visualLine,visualBlock:b.visualBlock}}function W(a,b,c){var d=a.state.vim;b=b||d.sel;c=c||d.visualLine?"line":d.visualBlock?"block":"char";b=va(a,b,c);a.setSelections(b.ranges,b.primary);Qa(a)}function va(a,b,c,d){var f=x(b.head),e=x(b.anchor);if("char"==c)return f=d||z(b.head,b.anchor)?0:1,e=z(b.head,b.anchor)?1:0,f=B(b.head,0,f),e=B(b.anchor,0,e),{ranges:[{anchor:e,head:f}],primary:0};if("line"==c)return z(b.head,b.anchor)?(f.ch=0,e.ch=
C(a,e.line)):(e.ch=0,b=a.lastLine(),f.line>b&&(f.line=b),f.ch=C(a,f.line)),{ranges:[{anchor:e,head:f}],primary:0};if("block"==c){b=Math.min(e.line,f.line);a=Math.min(e.ch,f.ch);c=Math.max(e.ch,f.ch)+1;e=Math.max(e.line,f.line)-b+1;f=f.line==b?0:e-1;d=[];for(var k=0;k<e;k++)d.push({anchor:l(b+k,a),head:l(b+k,c)});return{ranges:d,primary:f}}}function K(a,b){var c=a.state.vim;!1!==b&&a.setCursor(D(a,c.sel.head));Pa(a,c);c.visualMode=!1;c.visualLine=!1;c.visualBlock=!1;c.insertMode||g.signal(a,"vim-mode-change",
{mode:"normal"});Ra(c)}function L(a){if(!a)return 0;var b=a.search(/\S/);return-1==b?a.length:b}function ia(a,b,c,d,f){c=a.getCursor("head");1==a.getSelection().length&&(c=F(c,a.getCursor("anchor")));a=a.getLine(c.line);var e=c.ch;for(f=f?ja[0]:wa[0];!f(a.charAt(e));)if(e++,e>=a.length)return null;d?f=wa[0]:(f=ja[0],f(a.charAt(e))||(f=ja[1]));for(d=e;f(a.charAt(d))&&d<a.length;)d++;for(;f(a.charAt(e))&&0<=e;)e--;e++;if(b){for(b=d;/\s/.test(a.charAt(d))&&d<a.length;)d++;if(b==d){for(b=e;/\s/.test(a.charAt(e-
1))&&0<e;)e--;e||(e=b)}}return{start:l(c.line,e),end:l(c.line,d)}}function Sa(a,b){n.lastCharacterSearch.increment=a;n.lastCharacterSearch.forward=b.forward;n.lastCharacterSearch.selectedCharacter=b.selectedCharacter}function xa(a,b,c,d){for(var f=a.getCursor(),e=f.ch,k,u=0;u<b;u++){k=a.getLine(f.line);var h=d;k=c?k.indexOf(h,e+1):k.lastIndexOf(h,e-1);if(-1==k)return null;e=k}return l(a.getCursor().line,k)}function O(a,b,c,d){ra(c,ub)&&(b.marks[c]&&b.marks[c].clear(),b.marks[c]=a.setBookmark(d))}
function Ta(a,b,c,d,f){function e(b,c,d){return d?!a.getLine(b)!=!a.getLine(b+c):!!a.getLine(b)&&!a.getLine(b+c)}b=b.line;var k=a.firstLine(),u=a.lastLine(),h=b;if(d){for(;k<=h&&h<=u&&0<c;)e(h,d)&&c--,h+=d;return new l(h,0)}h=a.state.vim;h.visualLine&&e(b,1,!0)&&(h=h.sel.anchor,e(h.line,-1,!0)&&(f&&h.line==b||(b+=1)));d=!a.getLine(b);for(h=b;h<=u&&c;h++)e(h,1,!0)&&(f&&!a.getLine(h)==d||c--);c=new l(h,0);h>u&&!d?d=!0:f=!1;for(h=b;h>k&&(f&&!a.getLine(h)!=d&&h!=b||!e(h,-1,!0));h--);return{start:new l(h,
0),end:c}}function vb(a,b,c,d){function f(a,b){0>b.pos+b.dir||b.pos+b.dir>=b.line.length?(b.ln+=b.dir,qa(a,b.ln)?(b.line=a.getLine(b.ln),b.pos=0<b.dir?0:b.line.length-1):(b.line=null,b.ln=null,b.pos=null)):b.pos+=b.dir}function e(a,b,c,d){var e=a.getLine(b),h=""===e;e={line:e,ln:b,pos:c,dir:d};b={ln:e.ln,pos:e.pos};c=""===e.line;for(f(a,e);null!==e.line;){b.ln=e.ln;b.pos=e.pos;if(""!==e.line||c){if(h&&""!==e.line&&!T(e.line[e.pos]))return{ln:e.ln,pos:e.pos};-1==".?!".indexOf(e.line[e.pos])||h||e.pos!==
e.line.length-1&&!T(e.line[e.pos+1])||(h=!0)}else return{ln:e.ln,pos:e.pos};f(a,e)}e=a.getLine(b.ln);b.pos=0;for(a=e.length-1;0<=a;--a)if(!T(e[a])){b.pos=a;break}return b}function k(a,b,c,d){var e=a.getLine(b);e={line:e,ln:b,pos:c,dir:d};b={ln:e.ln,pos:null};c=""===e.line;for(f(a,e);null!==e.line;){if(""!==e.line||c){if(-1!=".?!".indexOf(e.line[e.pos])&&null!==b.pos&&(e.ln!==b.ln||e.pos+1!==b.pos))return b;""===e.line||T(e.line[e.pos])||(c=!1,b={ln:e.ln,pos:e.pos})}else return null!==b.pos?b:{ln:e.ln,
pos:e.pos};f(a,e)}e=a.getLine(b.ln);for(a=b.pos=0;a<e.length;++a)if(!T(e[a])){b.pos=a;break}return b}for(b={ln:b.line,pos:b.ch};0<c;)b=0>d?k(a,b.ln,b.pos,d):e(a,b.ln,b.pos,d),c--;return l(b.ln,b.pos)}function Ua(){}function P(a){a=a.state.vim;return a.searchState_||(a.searchState_=new Ua)}function Va(a,b){b=Wa(a,b)||[];if(!b.length)return[];var c=[];if(0===b[0]){for(var d=0;d<b.length;d++)"number"==typeof b[d]&&c.push(a.substring(b[d]+1,b[d+1]));return c}}function Wa(a,b){b||(b="/");for(var c=!1,
d=[],f=0;f<a.length;f++){var e=a.charAt(f);c||e!=b||d.push(f);c=!c&&"\\"==e}return d}function y(a,b){a.openNotification?a.openNotification('<span style="color: red">'+b+"</span>",{bottom:!0,duration:5E3}):alert(b)}function ka(a,b){var c=(b.prefix||"")+" "+(b.desc||""),d=b.desc,f='<span style="font-family: monospace; white-space: pre">'+(b.prefix||"")+'<input type="text" autocorrect="off" autocapitalize="off" spellcheck="false"></span>';d&&(f+=' <span style="color: #888">'+d+"</span>");d=b.onClose;
a.openDialog?a.openDialog(f,d,{bottom:!0,value:b.value,onKeyDown:b.onKeyDown,onKeyUp:b.onKeyUp,selectValueOnOpen:!1}):d(prompt(c,""))}function Y(a,b,c,d){if(b){var f=P(a);c=!!c;d=!!d;n.registerController.getRegister("/").setText(b);if(b instanceof RegExp)var e=b;else{var k=Wa(b,"/");if(k.length){var u=b.substring(0,k[0]);e=-1!=b.substring(k[0]).indexOf("i")}else u=b;if(u){if(!U("pcre")){b=u;k=!1;u=[];for(var h=-1;h<b.length;h++){var g=b.charAt(h)||"",l=b.charAt(h+1)||"",G=l&&-1!="|(){".indexOf(l);
k?("\\"===g&&G||u.push(g),k=!1):"\\"===g?(k=!0,l&&-1!="}".indexOf(l)&&(G=!0),G&&"\\"!==l||u.push(g)):(u.push(g),G&&"\\"!==l&&u.push("\\"))}u=u.join("")}d&&(c=/^[^A-Z]*$/.test(u));e=new RegExp(u,c||e?"i":void 0)}else e=null}if(e){Xa(a,e);a:if(a=f.getQuery(),e instanceof RegExp&&a instanceof RegExp){c=["global","multiline","ignoreCase","source"];for(d=0;d<c.length;d++)if(b=c[d],e[b]!==a[b]){a=!1;break a}a=!0}else a=!1;if(a)return e;f.setQuery(e);return e}}}function wb(a){if("^"==a.source.charAt(0))var b=
!0;return{token:function(c){if(b&&!c.sol())c.skipToEnd();else{var d=c.match(a,!1);if(d){if(0==d[0].length)return c.next(),"searching";if(!c.sol()&&(c.backUp(1),!a.exec(c.next()+d[0])))return c.next(),null;c.match(a);return"searching"}for(;!c.eol()&&(c.next(),!c.match(a,!1)););}},query:a}}function Xa(a,b){clearTimeout(Ya);Ya=setTimeout(function(){var c=P(a),d=c.getOverlay();d&&b==d.query||(d&&a.removeOverlay(d),d=wb(b),a.addOverlay(d),a.showMatchesOnScrollbar&&(c.getScrollbarAnnotate()&&c.getScrollbarAnnotate().clear(),
c.setScrollbarAnnotate(a.showMatchesOnScrollbar(b))),c.setOverlay(d))},50)}function Za(a,b,c,d){void 0===d&&(d=1);return a.operation(function(){for(var f=a.getCursor(),e=a.getSearchCursor(c,f),k=0;k<d;k++){var u=e.find(b);0==k&&u&&J(e.from(),f)&&(u=e.find(b));if(!u&&(e=a.getSearchCursor(c,b?l(a.lastLine()):l(a.firstLine(),0)),!e.find(b)))return}return e.from()})}function ya(a){var b=P(a);a.removeOverlay(P(a).getOverlay());b.setOverlay(null);b.getScrollbarAnnotate()&&(b.getScrollbarAnnotate().clear(),
b.setScrollbarAnnotate(null))}function xb(a,b,c){"number"!=typeof a&&(a=a.line);return b instanceof Array?ra(a,b):c?a>=b&&a<=c:a==b}function za(a){var b=a.getScrollInfo(),c=a.coordsChar({left:0,top:6+b.top},"local");a=a.coordsChar({left:0,top:b.clientHeight-10+b.top},"local");return{top:c.line,bottom:a.line}}function $a(a,b,c){return"'"==c||"`"==c?n.jumpList.find(a,-1)||l(0,0):"."==c?ab(a):(a=b.marks[c])&&a.find()}function ab(a){a=a.doc.history.done;for(var b=a.length;b--;)if(a[b].changes)return x(a[b].changes[0].to)}
function yb(a,b,c,d,f,e,k,u,h){function w(){a.operation(function(){for(;!n;)l(),G();t()})}function l(){var b=a.getRange(e.from(),e.to()).replace(k,u);e.replace(b)}function G(){for(;e.findNext()&&xb(e.from(),d,f);)if(c||!r||e.from().line!=r.line){a.scrollIntoView(e.from(),30);a.setSelection(e.from(),e.to());r=e.from();n=!1;return}n=!0}function t(b){b&&b();a.focus();r&&(a.setCursor(r),b=a.state.vim,b.exMode=!1,b.lastHPos=b.lastHSPos=r.ch);h&&h()}a.state.vim.exMode=!0;var n=!1,r=e.from();G();n?y(a,"No matches for "+
k.source):b?ka(a,{prefix:"replace with <strong>"+u+"</strong> (y/n/a/q/l)",onKeyDown:function(b,c,d){g.e_stop(b);switch(g.keyName(b)){case "Y":l();G();break;case "N":G();break;case "A":b=h;h=void 0;a.operation(w);h=b;break;case "L":l();case "Q":case "Esc":case "Ctrl-C":case "Ctrl-[":t(d)}n&&t(d);return!0}}):(w(),h&&h())}function Z(a){var b=a.state.vim,c=n.macroModeState,d=n.registerController.getRegister("."),f=c.isPlaying,e=c.lastInsertModeChanges;f||(a.off("change",bb),g.off(a.getInputField(),"keydown",
cb));!f&&1<b.insertModeRepeat&&(db(a,b,b.insertModeRepeat-1,!0),b.lastEditInputState.repeatOverride=b.insertModeRepeat);delete b.insertModeRepeat;b.insertMode=!1;a.setCursor(a.getCursor().line,a.getCursor().ch-1);a.setOption("keyMap","vim");a.setOption("disableInput",!0);a.toggleOverwrite(!1);d.setText(e.changes.join(""));g.signal(a,"vim-mode-change",{mode:"normal"});c.isRecording&&(c.isPlaying||(a=n.registerController.getRegister(c.latestRegister))&&a.pushInsertModeChanges&&a.pushInsertModeChanges(c.lastInsertModeChanges))}
function eb(a){m.unshift(a)}function bb(a,b){var c=n.macroModeState,d=c.lastInsertModeChanges;if(!c.isPlaying)for(;b;){d.expectCursorActivityForChange=!0;if(1<d.ignoreCount)d.ignoreCount--;else if("+input"==b.origin||"paste"==b.origin||void 0===b.origin)c=a.listSelections().length,1<c&&(d.ignoreCount=c),c=b.text.join("\n"),d.maybeReset&&(d.changes=[],d.maybeReset=!1),c&&(a.state.overwrite&&!/\n/.test(c)?d.changes.push([c]):d.changes.push(c));b=b.next}}function Ca(a){var b=a.state.vim;if(b.insertMode){var c=
n.macroModeState;if(c.isPlaying)return;c=c.lastInsertModeChanges;c.expectCursorActivityForChange?c.expectCursorActivityForChange=!1:c.maybeReset=!0}else if(!a.curOp.isVimOp){c=a.getCursor("anchor");var d=a.getCursor("head");b.visualMode&&!a.somethingSelected()?K(a,!1):b.visualMode||b.insertMode||!a.somethingSelected()||(b.visualMode=!0,b.visualLine=!1,g.signal(a,"vim-mode-change",{mode:"visual"}));if(b.visualMode){var f=z(d,c)?0:-1,e=z(d,c)?-1:0;d=B(d,0,f);c=B(c,0,e);b.sel={anchor:c,head:d};O(a,b,
"<",F(d,c));O(a,b,">",V(d,c))}else b.insertMode||(b.lastHPos=a.getCursor().ch)}b.visualMode&&Qa(a)}function Qa(a){var b=a.state.vim,c=D(a,x(b.sel.head)),d=B(c,0,1);Ra(b);c.ch==a.getLine(c.line).length?(d=document.createElement("span"),d.textContent="\u00a0",d.className="cm-animate-fat-cursor",b.fakeCursorBookmark=a.setBookmark(c,{widget:d})):b.fakeCursor=a.markText(c,d,{className:"cm-animate-fat-cursor"})}function Ra(a){a.fakeCursor&&(a.fakeCursor.clear(),a.fakeCursor=null);a.fakeCursorBookmark&&
(a.fakeCursorBookmark.clear(),a.fakeCursorBookmark=null)}function Aa(a){this.keyName=a}function cb(a){function b(){c.maybeReset&&(c.changes=[],c.maybeReset=!1);c.changes.push(new Aa(d));return!0}var c=n.macroModeState.lastInsertModeChanges,d=g.keyName(a);d&&(-1==d.indexOf("Delete")&&-1==d.indexOf("Backspace")||g.lookupKey(d,"vim-insert",b))}function db(a,b,c,d){function f(){u?S.processAction(a,b,b.lastEditActionCommand):S.evalInput(a,b)}function e(c){0<k.lastInsertModeChanges.changes.length&&(c=b.lastEditActionCommand?
c:1,fb(a,k.lastInsertModeChanges.changes,c))}var k=n.macroModeState;k.isPlaying=!0;var u=!!b.lastEditActionCommand,h=b.inputState;b.inputState=b.lastEditInputState;if(u&&b.lastEditActionCommand.interlaceInsertRepeat)for(var g=0;g<c;g++)f(),e(1);else d||f(),e(c);b.inputState=h;b.insertMode&&!d&&Z(a);k.isPlaying=!1}function fb(a,b,c){function d(b){if("string"==typeof b)g.commands[b](a);else b(a);return!0}var f=a.getCursor("head"),e=n.macroModeState.lastInsertModeChanges.visualBlock;e&&(Oa(a,f,e+1),
c=a.listSelections().length,a.setCursor(f));for(var k=0;k<c;k++){e&&a.setCursor(B(f,k,0));for(var u=0;u<b.length;u++){var h=b[u];if(h instanceof Aa)g.lookupKey(h.keyName,"vim-insert",d);else if("string"==typeof h){var w=a.getCursor();a.replaceRange(h,w,w)}else{w=a.getCursor();var l=B(w,0,h[0].length);a.replaceRange(h[0],w,l)}}}e&&a.setCursor(B(f,0,1))}g.defineOption("vimMode",!1,function(a,b,c){b&&"vim"!=a.getOption("keyMap")?a.setOption("keyMap","vim"):!b&&c!=g.Init&&/^vim/.test(a.getOption("keyMap"))&&
a.setOption("keyMap","default")});var Ea={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A"},Fa={Enter:"CR",Backspace:"BS",Delete:"Del",Insert:"Ins"},zb=/[\d]/,ja=[g.isWordChar,function(a){return a&&!g.isWordChar(a)&&!/\s/.test(a)}],wa=[function(a){return/\S/.test(a)}],gb=pa(65,26),hb=pa(97,26),ib=pa(48,10),ub=[].concat(gb,hb,ib,["<",">"]),jb=[].concat(gb,hb,ib,["-",'"',".",":","/"]),N={};ea("filetype",void 0,"string",["ft"],function(a,b){if(void 0!==b){if(void 0===a)return a=b.getOption("mode"),"null"==
a?"":a;b.setOption("mode",""==a?"null":a)}});var rb=function(){function a(a,k){b+=k;b>c?b=c:b<d&&(b=d);var e=f[(100+b)%100];if(e&&!e.find()){k=0<k?1:-1;var h;a=a.getCursor();do if(b+=k,(e=f[(100+b)%100])&&(h=e.find())&&!J(a,h))break;while(b<c&&b>d)}return e}var b=-1,c=0,d=0,f=Array(100);return{cachedCursor:void 0,add:function(a,k,u){function e(c){var d=++b%100,e=f[d];e&&e.clear();f[d]=a.setBookmark(c)}var g=f[b%100];g?(g=g.find())&&!J(g,k)&&e(k):e(k);e(u);c=b;d=b-100+1;0>d&&(d=0)},find:function(c,
d){var e=b;c=a(c,d);b=e;return c&&c.find()},move:a}},Ha=function(a){return a?{changes:a.changes,expectCursorActivityForChange:a.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};Ga.prototype={exitMacroRecordMode:function(){var a=n.macroModeState;if(a.onRecordingDone)a.onRecordingDone();a.onRecordingDone=void 0;a.isRecording=!1},enterMacroRecordMode:function(a,b){var c=n.registerController.getRegister(b);c&&(c.clear(),this.latestRegister=b,a.openDialog&&(this.onRecordingDone=
a.openDialog("(recording)["+b+"]",null,{bottom:!0})),this.isRecording=!0)}};var n,aa,Ab={buildKeyMap:function(){},getRegisterController:function(){return n.registerController},resetVimGlobalState_:Ia,getVimGlobalState_:function(){return n},maybeInitVimState_:ca,suppressErrorLogging:!1,InsertModeKey:Aa,map:function(a,b,c){M.map(a,b,c)},unmap:function(a,b){M.unmap(a,b)},noremap:function(a,b,c){function d(a){return a?[a]:["normal","insert","visual"]}for(var f=d(c),e=m.length,k=e-p;k<e&&f.length;k++){var g=
m[k];if(!(g.keys!=b||c&&g.context&&g.context!==c)&&"ex"!==g.type.substr(0,2)&&"key"!==g.type.substr(0,3)){var h={},w;for(w in g)h[w]=g[w];h.keys=a;c&&!h.context&&(h.context=c);this._mapCommand(h);var l=d(g.context);f=f.filter(function(a){return-1===l.indexOf(a)})}}},mapclear:function(a){var b=m.length,c=m.slice(0,b-p);m=m.slice(b-p);if(a)for(b=c.length-1;0<=b;b--){var d=c[b];if(a!==d.context)if(d.context)this._mapCommand(d);else{var f=["normal","insert","visual"],e;for(e in f)if(f[e]!==a){var k={},
g;for(g in d)k[g]=d[g];k.context=f[e];this._mapCommand(k)}}}},setOption:sa,getOption:U,defineOption:ea,defineEx:function(a,b,c){if(!b)b=a;else if(0!==a.indexOf(b))throw Error('(Vim.defineEx) "'+b+'" is not a prefix of "'+a+'", command not registered');kb[a]=c;M.commandMap_[b]={name:a,shortName:b,type:"api"}},handleKey:function(a,b,c){a=this.findKey(a,b,c);if("function"===typeof a)return a()},findKey:function(a,b,c){function d(){if("<Esc>"==b)return E(a),k.visualMode?K(a):k.insertMode&&Z(a),!0}function f(){if(d())return!0;
for(var c=k.inputState.keyBuffer+=b,e=1==b.length,f=S.matchCommand(c,m,k.inputState,"insert");1<c.length&&"full"!=f.type;){c=k.inputState.keyBuffer=c.slice(1);var g=S.matchCommand(c,m,k.inputState,"insert");"none"!=g.type&&(f=g)}if("none"==f.type)return E(a),!1;if("partial"==f.type)return aa&&window.clearTimeout(aa),aa=window.setTimeout(function(){k.insertMode&&k.inputState.keyBuffer&&E(a)},U("insertModeEscKeysTimeout")),!e;aa&&window.clearTimeout(aa);if(e){e=a.listSelections();for(g=0;g<e.length;g++){var u=
e[g].head;a.replaceRange("",B(u,0,-(c.length-1)),u,"+input")}n.macroModeState.lastInsertModeChanges.changes.pop()}E(a);return f.command}function e(){a:{var e=n.macroModeState;if(e.isRecording){if("q"==b){e.exitMacroRecordMode();E(a);var f=!0;break a}"mapping"!=c&&(f=b,e.isPlaying||(e=n.registerController.getRegister(e.latestRegister))&&e.pushText(f))}f=void 0}if(f||d())return!0;f=k.inputState.keyBuffer+=b;if(/^[1-9]\d*$/.test(f))return!0;e=/^(\d*)(.*)$/.exec(f);if(!e)return E(a),!1;var g=S.matchCommand(e[2]||
e[1],m,k.inputState,k.visualMode?"visual":"normal");if("none"==g.type)return E(a),!1;if("partial"==g.type)return!0;k.inputState.keyBuffer="";e=/^(\d*)(.*)$/.exec(f);e[1]&&"0"!=e[1]&&k.inputState.pushRepeatDigit(e[1]);return g.command}var k=ca(a);var u=k.insertMode?f():e();return!1===u?k.insertMode||1!==b.length?void 0:function(){return!0}:!0===u?function(){return!0}:function(){return a.operation(function(){a.curOp.isVimOp=!0;try{if("keyToKey"==u.type)for(var c=u.toKeys,d;c;)d=/<\w+-.+?>|<\w+>|./.exec(c),
b=d[0],c=c.substring(d.index+b.length),g.Vim.handleKey(a,b,"mapping");else S.processCommand(a,k,u)}catch(A){throw a.state.vim=void 0,ca(a),g.Vim.suppressErrorLogging||console.log(A),A;}return!0})}},handleEx:function(a,b){M.processCommand(a,b)},defineMotion:function(a,b){Q[a]=b},defineAction:function(a,b){da[a]=b},defineOperator:function(a,b){lb[a]=b},mapCommand:function(a,b,c,d,f){a={keys:a,type:b};a[b]=c;a[b+"Args"]=d;for(var e in f)a[e]=f[e];eb(a)},_mapCommand:eb,defineRegister:function(a,b){var c=
n.registerController.registers;if(!a||1!=a.length)throw Error("Register name must be 1 character");if(c[a])throw Error("Register already defined "+a);c[a]=b;jb.push(a)},exitVisualMode:K,exitInsertMode:Z};fa.prototype.pushRepeatDigit=function(a){this.operator?this.motionRepeat=this.motionRepeat.concat(a):this.prefixRepeat=this.prefixRepeat.concat(a)};fa.prototype.getRepeat=function(){var a=0;if(0<this.prefixRepeat.length||0<this.motionRepeat.length)a=1,0<this.prefixRepeat.length&&(a*=parseInt(this.prefixRepeat.join(""),
10)),0<this.motionRepeat.length&&(a*=parseInt(this.motionRepeat.join(""),10));return a};I.prototype={setText:function(a,b,c){this.keyBuffer=[a||""];this.linewise=!!b;this.blockwise=!!c},pushText:function(a,b){b&&(this.linewise||this.keyBuffer.push("\n"),this.linewise=!0);this.keyBuffer.push(a)},pushInsertModeChanges:function(a){this.insertModeChanges.push(Ha(a))},pushSearchQuery:function(a){this.searchQueries.push(a)},clear:function(){this.keyBuffer=[];this.insertModeChanges=[];this.searchQueries=
[];this.linewise=!1},toString:function(){return this.keyBuffer.join("")}};Ja.prototype={pushText:function(a,b,c,d,f){d&&"\n"!==c.charAt(c.length-1)&&(c+="\n");var e=this.isValidRegister(a)?this.getRegister(a):null;if(e)X(a)?e.pushText(c,d):e.setText(c,d,f),this.unnamedRegister.setText(e.toString(),d);else{switch(b){case "yank":this.registers["0"]=new I(c,d,f);break;case "delete":case "change":-1==c.indexOf("\n")?this.registers["-"]=new I(c,d):(this.shiftNumericRegisters_(),this.registers["1"]=new I(c,
d))}this.unnamedRegister.setText(c,d,f)}},getRegister:function(a){if(!this.isValidRegister(a))return this.unnamedRegister;a=a.toLowerCase();this.registers[a]||(this.registers[a]=new I);return this.registers[a]},isValidRegister:function(a){return a&&ra(a,jb)},shiftNumericRegisters_:function(){for(var a=9;2<=a;a--)this.registers[a]=this.getRegister(""+(a-1))}};ta.prototype={nextMatch:function(a,b){var c=this.historyBuffer,d=b?-1:1;null===this.initialPrefix&&(this.initialPrefix=a);for(var f=this.iterator+
d;b?0<=f:f<c.length;f+=d)for(var e=c[f],k=0;k<=e.length;k++)if(this.initialPrefix==e.substring(0,k))return this.iterator=f,e;if(f>=c.length)return this.iterator=c.length,this.initialPrefix;if(0>f)return a},pushInput:function(a){var b=this.historyBuffer.indexOf(a);-1<b&&this.historyBuffer.splice(b,1);a.length&&this.historyBuffer.push(a)},reset:function(){this.initialPrefix=null;this.iterator=this.historyBuffer.length}};var S={matchCommand:function(a,b,c,d){var f=[];var e=[];for(var k=0;k<b.length;k++){var g=
b[k],h;if(h=!("insert"==d&&"insert"!=g.context||g.context&&g.context!=d||c.operator&&"action"==g.type)){var l=a;var A=g.keys;if("<character>"==A.slice(-11)){h=A.length-11;var n=l.slice(0,h);A=A.slice(0,h);l=n==A&&l.length>h?"full":0==A.indexOf(n)?"partial":!1}else l=l==A?"full":0==A.indexOf(l)?"partial":!1;h=l}h&&("partial"==l&&f.push(g),"full"==l&&e.push(g))}b=f.length&&f;e=e.length&&e;if(!e&&!b)return{type:"none"};if(!e&&b)return{type:"partial"};var m;for(b=0;b<e.length;b++)d=e[b],m||(m=d);if("<character>"==
m.keys.slice(-11)){a=(e=/^.*(<[^>]+>)$/.exec(a))?e[1]:a.slice(-1);if(1<a.length)switch(a){case "<CR>":a="\n";break;case "<Space>":a=" ";break;default:a=""}if(!a)return{type:"none"};c.selectedCharacter=a}return{type:"full",command:m}},processCommand:function(a,b,c){b.inputState.repeatOverride=c.repeatOverride;switch(c.type){case "motion":this.processMotion(a,b,c);break;case "operator":this.processOperator(a,b,c);break;case "operatorMotion":this.processOperatorMotion(a,b,c);break;case "action":this.processAction(a,
b,c);break;case "search":this.processSearch(a,b,c);break;case "ex":case "keyToEx":this.processEx(a,b,c)}},processMotion:function(a,b,c){b.inputState.motion=c.motion;b.inputState.motionArgs=ha(c.motionArgs);this.evalInput(a,b)},processOperator:function(a,b,c){var d=b.inputState;if(d.operator){if(d.operator==c.operator){d.motion="expandToLine";d.motionArgs={linewise:!0};this.evalInput(a,b);return}E(a)}d.operator=c.operator;d.operatorArgs=ha(c.operatorArgs);c.exitVisualBlock&&(b.visualBlock=!1,W(a));
b.visualMode&&this.evalInput(a,b)},processOperatorMotion:function(a,b,c){var d=b.visualMode,f=ha(c.operatorMotionArgs);f&&d&&f.visualLine&&(b.visualLine=!0);this.processOperator(a,b,c);d||this.processMotion(a,b,c)},processAction:function(a,b,c){var d=b.inputState,f=d.getRepeat(),e=!!f,k=ha(c.actionArgs)||{};d.selectedCharacter&&(k.selectedCharacter=d.selectedCharacter);c.operator&&this.processOperator(a,b,c);c.motion&&this.processMotion(a,b,c);(c.motion||c.operator)&&this.evalInput(a,b);k.repeat=
f||1;k.repeatIsExplicit=e;k.registerName=d.registerName;E(a);b.lastMotion=null;c.isEdit&&this.recordLastEdit(b,d,c);da[c.action](a,k,b)},processSearch:function(a,b,c){function d(d,e,f){n.searchHistoryController.pushInput(d);n.searchHistoryController.reset();try{Y(a,d,e,f)}catch(Db){y(a,"Invalid regex: "+d);E(a);return}S.processMotion(a,b,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:c.searchArgs.toJumplist}})}function f(b){a.scrollTo(m.left,m.top);d(b,!0,!0);var c=n.macroModeState;
c.isRecording&&(c.isPlaying||(c=n.registerController.getRegister(c.latestRegister))&&c.pushSearchQuery&&c.pushSearchQuery(b))}function e(b,c,d){var e=g.keyName(b);if("Up"==e||"Down"==e){var f=b.target?b.target.selectionEnd:0;c=n.searchHistoryController.nextMatch(c,"Up"==e?!0:!1)||"";d(c);f&&b.target&&(b.target.selectionEnd=b.target.selectionStart=Math.min(f,b.target.value.length))}else"Left"!=e&&"Right"!=e&&"Ctrl"!=e&&"Alt"!=e&&"Shift"!=e&&n.searchHistoryController.reset();try{var h=Y(a,c,!0,!0)}catch(la){}h?
a.scrollIntoView(Za(a,!u,h),30):(ya(a),a.scrollTo(m.left,m.top))}function k(b,c,d){var e=g.keyName(b);"Esc"==e||"Ctrl-C"==e||"Ctrl-["==e||"Backspace"==e&&""==c?(n.searchHistoryController.pushInput(c),n.searchHistoryController.reset(),Y(a,A),ya(a),a.scrollTo(m.left,m.top),g.e_stop(b),E(a),d(),a.focus()):"Up"==e||"Down"==e?g.e_stop(b):"Ctrl-U"==e&&(g.e_stop(b),d(""))}if(a.getSearchCursor){var u=c.searchArgs.forward,h=c.searchArgs.wholeWordOnly;P(a).setReversed(!u);var l=u?"/":"?",A=P(a).getQuery(),
m=a.getScrollInfo();switch(c.searchArgs.querySrc){case "prompt":h=n.macroModeState;h.isPlaying?(l=h.replaySearchQueries.shift(),d(l,!0,!1)):ka(a,{onClose:f,prefix:l,desc:Bb,onKeyUp:e,onKeyDown:k});break;case "wordUnderCursor":var t=ia(a,!1,!0,!1,!0),v=!0;t||(t=ia(a,!1,!0,!1,!1),v=!1);t&&(l=a.getLine(t.start.line).substring(t.start.ch,t.end.ch),l=v&&h?"\\b"+l+"\\b":l.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1"),n.jumpList.cachedCursor=a.getCursor(),a.setCursor(t.start),d(l,!0,!1))}}},processEx:function(a,
b,c){function d(b){n.exCommandHistoryController.pushInput(b);n.exCommandHistoryController.reset();M.processCommand(a,b)}function f(b,c,d){var e=g.keyName(b);if("Esc"==e||"Ctrl-C"==e||"Ctrl-["==e||"Backspace"==e&&""==c)n.exCommandHistoryController.pushInput(c),n.exCommandHistoryController.reset(),g.e_stop(b),E(a),d(),a.focus();if("Up"==e||"Down"==e){g.e_stop(b);var f=b.target?b.target.selectionEnd:0;c=n.exCommandHistoryController.nextMatch(c,"Up"==e?!0:!1)||"";d(c);f&&b.target&&(b.target.selectionEnd=
b.target.selectionStart=Math.min(f,b.target.value.length))}else"Ctrl-U"==e?(g.e_stop(b),d("")):"Left"!=e&&"Right"!=e&&"Ctrl"!=e&&"Alt"!=e&&"Shift"!=e&&n.exCommandHistoryController.reset()}"keyToEx"==c.type?M.processCommand(a,c.exArgs.input):b.visualMode?ka(a,{onClose:d,prefix:":",value:"'<,'>",onKeyDown:f,selectValueOnOpen:!1}):ka(a,{onClose:d,prefix:":",onKeyDown:f})},evalInput:function(a,b){var c=b.inputState,d=c.motion,f=c.motionArgs||{},e=c.operator,k=c.operatorArgs||{},g=c.registerName,h=b.sel,
w=x(b.visualMode?D(a,h.head):a.getCursor("head")),A=x(b.visualMode?D(a,h.anchor):a.getCursor("anchor")),m=x(w);A=x(A);e&&this.recordLastEdit(b,c);var t=void 0!==c.repeatOverride?c.repeatOverride:c.getRepeat();if(0<t&&f.explicitRepeat)f.repeatIsExplicit=!0;else if(f.noRepeat||!f.explicitRepeat&&0===t)t=1,f.repeatIsExplicit=!1;c.selectedCharacter&&(f.selectedCharacter=k.selectedCharacter=c.selectedCharacter);f.repeat=t;E(a);if(d){var v=Q[d](a,w,f,b);b.lastMotion=Q[d];if(!v)return;f.toJumplist&&(d=n.jumpList,
(c=d.cachedCursor)?(J(c,v)||n.jumpList.add(a,c,v),delete d.cachedCursor):J(w,v)||n.jumpList.add(a,w,v));if(v instanceof Array){var r=v[0];v=v[1]}v||(v=x(w));b.visualMode?(b.visualBlock&&Infinity===v.ch||(v=D(a,v)),r&&(r=D(a,r)),r=r||A,h.anchor=r,h.head=v,W(a),O(a,b,"<",z(r,v)?r:v),O(a,b,">",z(r,v)?v:r)):e||(v=D(a,v),a.setCursor(v.line,v.ch))}if(e){k.lastSel?(r=A,h=k.lastSel,v=Math.abs(h.head.line-h.anchor.line),w=Math.abs(h.head.ch-h.anchor.ch),v=h.visualLine?l(A.line+v,A.ch):h.visualBlock?l(A.line+
v,A.ch+w):h.head.line==h.anchor.line?l(A.line,A.ch+w):l(A.line+v,A.ch),b.visualMode=!0,b.visualLine=h.visualLine,b.visualBlock=h.visualBlock,h=b.sel={anchor:r,head:v},W(a)):b.visualMode&&(k.lastSel={anchor:x(h.anchor),head:x(h.head),visualBlock:b.visualBlock,visualLine:b.visualLine});if(b.visualMode){if(r=F(h.head,h.anchor),h=V(h.head,h.anchor),m=b.visualLine||k.linewise,f=b.visualBlock?"block":m?"line":"char",r=va(a,{anchor:r,head:h},f),m)if(h=r.ranges,"block"==f)for(f=0;f<h.length;f++)h[f].head.ch=
C(a,h[f].head.line);else"line"==f&&(h[0].head=l(h[0].head.line+1,0))}else{r=x(r||A);h=x(v||m);z(h,r)&&(m=r,r=h,h=m);if(m=f.linewise||k.linewise)w=h,r.ch=0,w.ch=0,w.line++;else if(f.forward&&(w=h,d=a.getRange(r,w),/\n\s*$/.test(d))){d=d.split("\n");d.pop();for(c=d.pop();0<d.length&&c&&T(c);c=d.pop())w.line--,w.ch=0;c?(w.line--,w.ch=C(a,w.line)):w.ch=0}r=va(a,{anchor:r,head:h},"char",!f.inclusive||m)}a.setSelections(r.ranges,r.primary);b.lastMotion=null;k.repeat=t;k.registerName=g;k.linewise=m;e=lb[e](a,
k,r.ranges,A,v);b.visualMode&&K(a,null!=e);e&&a.setCursor(e)}},recordLastEdit:function(a,b,c){var d=n.macroModeState;d.isPlaying||(a.lastEditInputState=b,a.lastEditActionCommand=c,d.lastInsertModeChanges.changes=[],d.lastInsertModeChanges.expectCursorActivityForChange=!1,d.lastInsertModeChanges.visualBlock=a.visualBlock?a.sel.head.line-a.sel.anchor.line:0)}},Q={moveToTopLine:function(a,b,c){b=za(a).top+c.repeat-1;return l(b,L(a.getLine(b)))},moveToMiddleLine:function(a){var b=za(a);b=Math.floor(.5*
(b.top+b.bottom));return l(b,L(a.getLine(b)))},moveToBottomLine:function(a,b,c){b=za(a).bottom-c.repeat+1;return l(b,L(a.getLine(b)))},expandToLine:function(a,b,c){return l(b.line+c.repeat-1,Infinity)},findNext:function(a,b,c){b=P(a);var d=b.getQuery();if(d){var f=!c.forward;f=b.isReversed()?!f:f;Xa(a,d);return Za(a,f,d,c.repeat)}},goToMark:function(a,b,c,d){return(b=$a(a,d,c.selectedCharacter))?c.linewise?{line:b.line,ch:L(a.getLine(b.line))}:b:null},moveToOtherHighlightedEnd:function(a,b,c,d){return d.visualBlock&&
c.sameLine?(b=d.sel,[D(a,l(b.anchor.line,b.head.ch)),D(a,l(b.head.line,b.anchor.ch))]):[d.sel.head,d.sel.anchor]},jumpToMark:function(a,b,c,d){for(var f=0;f<c.repeat;f++){var e=b,k;for(k in d.marks)if(/^[a-z]$/.test(k)){var g=d.marks[k].find();if(c.forward?!z(g,e):!z(e,g))if(!c.linewise||g.line!=e.line){var h=J(e,b),w=c.forward?Ma(e,g,b):Ma(b,g,e);if(h||w)b=g}}}c.linewise&&(b=l(b.line,L(a.getLine(b.line))));return b},moveByCharacters:function(a,b,c){a=c.repeat;return l(b.line,c.forward?b.ch+a:b.ch-
a)},moveByLines:function(a,b,c,d){var f=b.ch;switch(d.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:f=d.lastHPos;break;default:d.lastHPos=f}var e=c.repeat+(c.repeatOffset||0),k=c.forward?b.line+e:b.line-e,g=a.firstLine(),h=a.lastLine();e=a.findPosV(b,c.forward?e:-e,"line",d.lastHSPos);if(c.forward?e.line>k:e.line<k)k=e.line,f=e.ch;if(k<g&&b.line==g)return this.moveToStartOfLine(a,b,c,d);if(k>h&&b.line==h)return this.moveToEol(a,
b,c,d,!0);c.toFirstChar&&(f=L(a.getLine(k)),d.lastHPos=f);d.lastHSPos=a.charCoords(l(k,f),"div").left;return l(k,f)},moveByDisplayLines:function(a,b,c,d){switch(d.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:d.lastHSPos=a.charCoords(b,"div").left}var f=c.repeat;b=a.findPosV(b,c.forward?f:-f,"line",d.lastHSPos);b.hitSide&&(c.forward?(c={top:a.charCoords(b,"div").top+8,left:d.lastHSPos},b=a.coordsChar(c,
"div")):(c=a.charCoords(l(a.firstLine(),0),"div"),c.left=d.lastHSPos,b=a.coordsChar(c,"div")));d.lastHPos=b.ch;return b},moveByPage:function(a,b,c){var d=c.repeat;return a.findPosV(b,c.forward?d:-d,"page")},moveByParagraph:function(a,b,c){return Ta(a,b,c.repeat,c.forward?1:-1)},moveBySentence:function(a,b,c){return vb(a,b,c.repeat,c.forward?1:-1)},moveByScroll:function(a,b,c,d){var f=a.getScrollInfo(),e=c.repeat;e||(e=f.clientHeight/(2*a.defaultTextHeight()));var k=a.charCoords(b,"local");c.repeat=
e;b=Q.moveByDisplayLines(a,b,c,d);if(!b)return null;c=a.charCoords(b,"local");a.scrollTo(null,f.top+c.top-k.top);return b},moveByWords:function(a,b,c){var d=b,f=c.repeat;b=!!c.forward;var e=!!c.wordEnd,k=!!c.bigWord;c=x(d);var g=[];(b&&!e||!b&&e)&&f++;for(var h=!(b&&e),w=0;w<f;w++){b:{var m=a;var n=b,t=k,v=h,r=d.line,p=d.ch,q=m.getLine(r),y=n?1:-1;t=t?wa:ja;if(v&&""==q){r+=y;q=m.getLine(r);if(!qa(m,r)){m=null;break b}p=n?0:q.length}for(;;){if(v&&""==q){m={from:0,to:0,line:r};break b}n=0<y?q.length:
-1;for(var z,ba;p!=n;){for(var la=!1,ma=0;ma<t.length&&!la;++ma)if(t[ma](q.charAt(p))){for(z=p;p!=n&&t[ma](q.charAt(p));)p+=y;ba=p;la=z!=ba;if(z!=d.ch||r!=d.line||ba!=z+y){m={from:Math.min(z,ba+1),to:Math.max(z,ba),line:r};break b}}la||(p+=y)}r+=y;if(!qa(m,r)){m=null;break b}q=m.getLine(r);p=0<y?0:q.length}}if(!m){k=C(a,a.lastLine());g.push(b?{line:a.lastLine(),from:k,to:k}:{line:0,from:0,to:0});break}g.push(m);d=l(m.line,b?m.to-1:m.from)}a=g.length!=f;f=g[0];k=g.pop();b&&!e?(a||f.from==c.ch&&f.line==
c.line||(k=g.pop()),b=l(k.line,k.from)):b&&e?b=l(k.line,k.to-1):!b&&e?(a||f.to==c.ch&&f.line==c.line||(k=g.pop()),b=l(k.line,k.to)):b=l(k.line,k.from);return b},moveTillCharacter:function(a,b,c){a=xa(a,c.repeat,c.forward,c.selectedCharacter);b=c.forward?-1:1;Sa(b,c);if(!a)return null;a.ch+=b;return a},moveToCharacter:function(a,b,c){var d=c.repeat;Sa(0,c);return xa(a,d,c.forward,c.selectedCharacter)||b},moveToSymbol:function(a,b,c){var d=c.repeat,f=c.forward,e=c.selectedCharacter;c=x(a.getCursor());
var k=f?1:-1,g=f?a.lineCount():-1,h=c.ch,m=c.line,n=a.getLine(m);f={lineText:n,nextCh:n.charAt(h),lastCh:null,index:h,symb:e,reverseSymb:(f?{")":"(","}":"{"}:{"(":")","{":"}"})[e],forward:f,depth:0,curMoveThrough:!1};if(h=Cb[e]){e=mb[h].init;h=mb[h].isComplete;for(e&&e(f);m!==g&&d;)f.index+=k,f.nextCh=f.lineText.charAt(f.index),f.nextCh||(m+=k,f.lineText=a.getLine(m)||"",0<k?f.index=0:(e=f.lineText.length,f.index=0<e?e-1:0),f.nextCh=f.lineText.charAt(f.index)),h(f)&&(c.line=m,c.ch=f.index,d--);a=
f.nextCh||f.curMoveThrough?l(m,f.index):c}else a=c;return a||b},moveToColumn:function(a,b,c,d){c=c.repeat;d.lastHPos=c-1;d.lastHSPos=a.charCoords(b,"div").left;b=a.getCursor().line;return D(a,l(b,c-1))},moveToEol:function(a,b,c,d,f){b=l(b.line+c.repeat-1,Infinity);c=a.clipPos(b);c.ch--;f||(d.lastHPos=Infinity,d.lastHSPos=a.charCoords(c,"div").left);return b},moveToFirstNonWhiteSpaceCharacter:function(a,b){return l(b.line,L(a.getLine(b.line)))},moveToMatchedSymbol:function(a,b){for(var c=b.line,d=
b.ch,f=a.getLine(c),e;d<f.length&&(!(e=f.charAt(d))||-1=="()[]{}".indexOf(e)||(e=a.getTokenTypeAt(l(c,d+1)),"string"===e||"comment"===e));d++);return d<f.length?(b="<"===d||">"===d?/[(){}[\]<>]/:/[(){}[\]]/,a.findMatchingBracket(l(c,d),{bracketRegex:b}).to):b},moveToStartOfLine:function(a,b){return l(b.line,0)},moveToLineOrEdgeOfDocument:function(a,b,c){b=c.forward?a.lastLine():a.firstLine();c.repeatIsExplicit&&(b=c.repeat-a.getOption("firstLineNumber"));return l(b,L(a.getLine(b)))},textObjectManipulation:function(a,
b,c,d){var f={"'":!0,'"':!0,"`":!0},e=c.selectedCharacter;"b"==e?e="(":"B"==e&&(e="{");var k=!c.textObjectInner;if({"(":")",")":"(","{":"}","}":"{","[":"]","]":"[","<":">",">":"<"}[e]){var g={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/,"<":/[<>]/,">":/[<>]/}[e];var h={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{","<":"<",">":"<"}[e];c=a.getLine(b.line).charAt(b.ch)===h?1:0;h=a.scanForBracket(l(b.line,b.ch+c),-1,void 0,{bracketRegex:g});g=a.scanForBracket(l(b.line,b.ch+c),
1,void 0,{bracketRegex:g});if(h&&g){h=h.pos;g=g.pos;if(h.line==g.line&&h.ch>g.ch||h.line>g.line)b=h,h=g,g=b;k?g.ch+=1:h.ch+=1;b={start:h,end:g}}else b={start:b,end:b}}else if(f[e]){c=e;b=x(b);d=a.getLine(b.line).split("");e=d.indexOf(c);b.ch<e?b.ch=e:e<b.ch&&d[b.ch]==c&&(g=b.ch,--b.ch);if(d[b.ch]!=c||g)for(e=b.ch;-1<e&&!h;e--)d[e]==c&&(h=e+1);else h=b.ch+1;if(h&&!g)for(e=h,f=d.length;e<f&&!g;e++)d[e]==c&&(g=e);h&&g?(k&&(--h,++g),b={start:l(b.line,h),end:l(b.line,g)}):b={start:b,end:b}}else if("W"===
e)b=ia(a,k,!0,!0);else if("w"===e)b=ia(a,k,!0,!1);else if("p"===e)if(b=Ta(a,b,c.repeat,0,k),c.linewise=!0,d.visualMode)d.visualLine||(d.visualLine=!0);else{if(k=d.inputState.operatorArgs)k.linewise=!0;b.end.line--}else return null;return a.state.vim.visualMode?(k=b.start,b=b.end,g=a.state.vim.sel,h=g.head,g=g.anchor,z(b,k)&&(c=b,b=k,k=c),z(h,g)?(h=F(k,h),g=V(g,b)):(g=F(k,g),h=V(h,b),h=B(h,0,-1),-1==h.ch&&h.line!=a.firstLine()&&(h=l(h.line-1,C(a,h.line-1)))),[g,h]):[b.start,b.end]},repeatLastCharacterSearch:function(a,
b,c){var d=n.lastCharacterSearch,f=c.repeat,e=c.forward===d.forward,g=(d.increment?1:0)*(e?-1:1);a.moveH(-g,"char");c.inclusive=e?!0:!1;c=xa(a,f,e,d.selectedCharacter);if(!c)return a.moveH(g,"char"),b;c.ch+=g;return c}},lb={change:function(a,b,c){var d=a.state.vim;var f=c[0].anchor;var e=c[0].head;if(d.visualMode)if(b.fullLine){e.ch=Number.MAX_VALUE;e.line--;a.setSelection(f,e);var k=a.getSelection();a.replaceSelection("")}else k=a.getSelection(),f=Ka("",c.length),a.replaceSelections(f),f=F(c[0].head,
c[0].anchor);else{k=a.getRange(f,e);d=d.lastEditInputState||{};if("moveByWords"==d.motion&&!T(k)){var m=/\s+$/.exec(k);m&&d.motionArgs&&d.motionArgs.forward&&(e=B(e,0,-m[0].length),k=k.slice(0,-m[0].length))}d=new l(f.line-1,Number.MAX_VALUE);m=a.firstLine()==a.lastLine();e.line>a.lastLine()&&b.linewise&&!m?a.replaceRange("",d,e):a.replaceRange("",f,e);b.linewise&&(m||(a.setCursor(d),g.commands.newlineAndIndent(a)),f.ch=Number.MAX_VALUE)}n.registerController.pushText(b.registerName,"change",k,b.linewise,
1<c.length);da.enterInsertMode(a,{head:f},a.state.vim)},"delete":function(a,b,c){var d=a.state.vim;if(d.visualBlock){var f=a.getSelection();var e=Ka("",c.length);a.replaceSelections(e);c=c[0].anchor}else e=c[0].anchor,c=c[0].head,b.linewise&&c.line!=a.firstLine()&&e.line==a.lastLine()&&e.line==c.line-1&&(e.line==a.firstLine()?e.ch=0:e=l(e.line-1,C(a,e.line-1))),f=a.getRange(e,c),a.replaceRange("",e,c),c=e,b.linewise&&(c=Q.moveToFirstNonWhiteSpaceCharacter(a,e));n.registerController.pushText(b.registerName,
"delete",f,b.linewise,d.visualBlock);return D(a,c)},indent:function(a,b,c){var d=a.state.vim,f=c[0].anchor.line,e=d.visualBlock?c[c.length-1].anchor.line:c[0].head.line;d=d.visualMode?b.repeat:1;for(b.linewise&&e--;f<=e;f++)for(var g=0;g<d;g++)a.indentLine(f,b.indentRight);return Q.moveToFirstNonWhiteSpaceCharacter(a,c[0].anchor)},indentAuto:function(a,b,c){a.execCommand("indentAuto");return Q.moveToFirstNonWhiteSpaceCharacter(a,c[0].anchor)},changeCase:function(a,b,c,d,f){for(var e=a.getSelections(),
g=[],l=b.toLower,h=0;h<e.length;h++){var m=e[h],n="";if(!0===l)n=m.toLowerCase();else if(!1===l)n=m.toUpperCase();else for(var p=0;p<m.length;p++){var t=m.charAt(p);n+=X(t)?t.toLowerCase():t.toUpperCase()}g.push(n)}a.replaceSelections(g);return b.shouldMoveCursor?f:!a.state.vim.visualMode&&b.linewise&&c[0].anchor.line+1==c[0].head.line?Q.moveToFirstNonWhiteSpaceCharacter(a,d):b.linewise?d:F(c[0].anchor,c[0].head)},yank:function(a,b,c,d){var f=a.state.vim;a=a.getSelection();c=f.visualMode?F(f.sel.anchor,
f.sel.head,c[0].head,c[0].anchor):d;n.registerController.pushText(b.registerName,"yank",a,b.linewise,f.visualBlock);return c}},da={jumpListWalk:function(a,b,c){c.visualMode||(c=b.repeat,b=(b=(b=n.jumpList.move(a,b.forward?c:-c))?b.find():void 0)?b:a.getCursor(),a.setCursor(b))},scroll:function(a,b,c){if(!c.visualMode){var d=b.repeat||1;c=a.defaultTextHeight();var f=a.getScrollInfo().top;d*=c;f=b.forward?f+d:f-d;d=x(a.getCursor());var e=a.charCoords(d,"local");b.forward?f>e.top?(d.line+=(f-e.top)/
c,d.line=Math.ceil(d.line),a.setCursor(d),e=a.charCoords(d,"local"),a.scrollTo(null,e.top)):a.scrollTo(null,f):(b=f+a.getScrollInfo().clientHeight,b<e.bottom?(d.line-=(e.bottom-b)/c,d.line=Math.floor(d.line),a.setCursor(d),e=a.charCoords(d,"local"),a.scrollTo(null,e.bottom-a.getScrollInfo().clientHeight)):a.scrollTo(null,f))}},scrollToCursor:function(a,b){var c=a.getCursor().line,d=a.charCoords(l(c,0),"local");c=a.getScrollInfo().clientHeight;var f=d.top;d=d.bottom-f;switch(b.position){case "center":f=
f-c/2+d;break;case "bottom":f=f-c+d}a.scrollTo(null,f)},replayMacro:function(a,b,c){var d=b.selectedCharacter;b=b.repeat;var f=n.macroModeState;for("@"==d?d=f.latestRegister:f.latestRegister=d;b--;){var e=a,k=c,l=f,h=d,m=n.registerController.getRegister(h);if(":"==h)m.keyBuffer[0]&&M.processCommand(e,m.keyBuffer[0]);else{h=m.keyBuffer;var p=0;l.isPlaying=!0;l.replaySearchQueries=m.searchQueries.slice(0);for(var q=0;q<h.length;q++)for(var t=h[q],v,r;t;)v=/<\w+-.+?>|<\w+>|./.exec(t),r=v[0],t=t.substring(v.index+
r.length),g.Vim.handleKey(e,r,"macro"),k.insertMode&&(v=m.insertModeChanges[p++].changes,n.macroModeState.lastInsertModeChanges.changes=v,fb(e,v,1),Z(e))}l.isPlaying=!1}},enterMacroRecordMode:function(a,b){var c=n.macroModeState;b=b.selectedCharacter;n.registerController.isValidRegister(b)&&c.enterMacroRecordMode(a,b)},toggleOverwrite:function(a){a.state.overwrite?(a.toggleOverwrite(!1),a.setOption("keyMap","vim-insert"),g.signal(a,"vim-mode-change",{mode:"insert"})):(a.toggleOverwrite(!0),a.setOption("keyMap",
"vim-replace"),g.signal(a,"vim-mode-change",{mode:"replace"}))},enterInsertMode:function(a,b,c){if(!a.getOption("readOnly")){c.insertMode=!0;c.insertModeRepeat=b&&b.repeat||1;var d=b?b.insertAt:null,f=c.sel,e=b.head||a.getCursor("head"),k=a.listSelections().length;if("eol"==d)e=l(e.line,C(a,e.line));else if("bol"==d)e=l(e.line,0);else if("charAfter"==d)e=B(e,0,1);else if("firstNonBlank"==d)e=Q.moveToFirstNonWhiteSpaceCharacter(a,e);else if("startOfSelectedArea"==d){if(!c.visualMode)return;c.visualBlock?
(e=l(Math.min(f.head.line,f.anchor.line),Math.min(f.head.ch,f.anchor.ch)),k=Math.abs(f.head.line-f.anchor.line)+1):e=f.head.line<f.anchor.line?f.head:l(f.anchor.line,0)}else if("endOfSelectedArea"==d){if(!c.visualMode)return;c.visualBlock?(e=l(Math.min(f.head.line,f.anchor.line),Math.max(f.head.ch+1,f.anchor.ch)),k=Math.abs(f.head.line-f.anchor.line)+1):e=f.head.line>=f.anchor.line?B(f.head,0,1):l(f.anchor.line,0)}else if("inplace"==d){if(c.visualMode)return}else"lastEdit"==d&&(e=ab(a)||e);a.setOption("disableInput",
!1);b&&b.replace?(a.toggleOverwrite(!0),a.setOption("keyMap","vim-replace"),g.signal(a,"vim-mode-change",{mode:"replace"})):(a.toggleOverwrite(!1),a.setOption("keyMap","vim-insert"),g.signal(a,"vim-mode-change",{mode:"insert"}));n.macroModeState.isPlaying||(a.on("change",bb),g.on(a.getInputField(),"keydown",cb));c.visualMode&&K(a);Oa(a,e,k)}},toggleVisualMode:function(a,b,c){var d=b.repeat,f=a.getCursor();c.visualMode?c.visualLine^b.linewise||c.visualBlock^b.blockwise?(c.visualLine=!!b.linewise,c.visualBlock=
!!b.blockwise,g.signal(a,"vim-mode-change",{mode:"visual",subMode:c.visualLine?"linewise":c.visualBlock?"blockwise":""}),W(a)):K(a):(c.visualMode=!0,c.visualLine=!!b.linewise,c.visualBlock=!!b.blockwise,b=D(a,l(f.line,f.ch+d-1)),c.sel={anchor:f,head:b},g.signal(a,"vim-mode-change",{mode:"visual",subMode:c.visualLine?"linewise":c.visualBlock?"blockwise":""}),W(a),O(a,c,"<",F(f,b)),O(a,c,">",V(f,b)))},reselectLastSelection:function(a,b,c){b=c.lastSelection;c.visualMode&&Pa(a,c);if(b){var d=b.anchorMark.find(),
f=b.headMark.find();d&&f&&(c.sel={anchor:d,head:f},c.visualMode=!0,c.visualLine=b.visualLine,c.visualBlock=b.visualBlock,W(a),O(a,c,"<",F(d,f)),O(a,c,">",V(d,f)),g.signal(a,"vim-mode-change",{mode:"visual",subMode:c.visualLine?"linewise":c.visualBlock?"blockwise":""}))}},joinLines:function(a,b,c){if(c.visualMode){var d=a.getCursor("anchor");var f=a.getCursor("head");if(z(f,d)){var e=f;f=d;d=e}f.ch=C(a,f.line)-1}else f=Math.max(b.repeat,2),d=a.getCursor(),f=D(a,l(d.line+f-1,Infinity));for(var g=0,
m=d.line;m<f.line;m++){g=C(a,d.line);e=l(d.line+1,C(a,d.line+1));var h=a.getRange(d,e);h=b.keepSpaces?h.replace(/\n\r?/g,""):h.replace(/\n\s*/g," ");a.replaceRange(h,d,e)}b=l(d.line,g);c.visualMode&&K(a,!1);a.setCursor(b)},newLineAndEnterInsertMode:function(a,b,c){c.insertMode=!0;var d=x(a.getCursor());d.line!==a.firstLine()||b.after?(d.line=b.after?d.line:d.line-1,d.ch=C(a,d.line),a.setCursor(d),(g.commands.newlineAndIndentContinueComment||g.commands.newlineAndIndent)(a)):(a.replaceRange("\n",l(a.firstLine(),
0)),a.setCursor(a.firstLine(),0));this.enterInsertMode(a,{repeat:b.repeat},c)},paste:function(a,b,c){var d=x(a.getCursor()),f=n.registerController.getRegister(b.registerName),e=f.toString();if(e){if(b.matchIndent){var g=a.getOption("tabSize"),m=function(a){var b=a.split("\t").length-1;a=a.split(" ").length-1;return b*g+1*a},h=a.getLine(a.getCursor().line),w=m(h.match(/^\s*/)[0]);h=e.replace(/\n$/,"");var p=e!==h,q=m(e.match(/^\s*/)[0]);e=h.replace(/^\s*/gm,function(b){b=w+(m(b)-q);return 0>b?"":a.getOption("indentWithTabs")?
Array(Math.floor(b/g)+1).join("\t"):Array(b+1).join(" ")});e+=p?"\n":""}1<b.repeat&&(e=Array(b.repeat+1).join(e));h=f.linewise;if(f=f.blockwise){e=e.split("\n");h&&e.pop();for(p=0;p<e.length;p++)e[p]=""==e[p]?" ":e[p];d.ch+=b.after?1:0;d.ch=Math.min(C(a,d.line),d.ch)}else h?c.visualMode?e=c.visualLine?e.slice(0,-1):"\n"+e.slice(0,e.length-1)+"\n":b.after?(e="\n"+e.slice(0,e.length-1),d.ch=C(a,d.line)):d.ch=0:d.ch+=b.after?1:0;var t;if(c.visualMode){c.lastPastedText=e;b=tb(a,c);d=b[0];b=b[1];p=a.getSelection();
var v=a.listSelections();v=Array(v.length).join("1").split("1");c.lastSelection&&(t=c.lastSelection.headMark.find());n.registerController.unnamedRegister.setText(p);f?(a.replaceSelections(v),b=l(d.line+e.length-1,d.ch),a.setCursor(d),Na(a,b),a.replaceSelections(e),e=d):c.visualBlock?(a.replaceSelections(v),a.setCursor(d),a.replaceRange(e,d,d),e=d):(a.replaceRange(e,d,b),e=a.posFromIndex(a.indexFromPos(d)+e.length-1));t&&(c.lastSelection.headMark=a.setBookmark(t));h&&(e.ch=0)}else if(f){a.setCursor(d);
for(p=0;p<e.length;p++)t=d.line+p,t>a.lastLine()&&a.replaceRange("\n",l(t,0)),C(a,t)<d.ch&&sb(a,t,d.ch);a.setCursor(d);Na(a,l(d.line+e.length-1,d.ch));a.replaceSelections(e);e=d}else a.replaceRange(e,d),h&&b.after?e=l(d.line+1,L(a.getLine(d.line+1))):h&&!b.after?e=l(d.line,L(a.getLine(d.line))):!h&&b.after?(t=a.indexFromPos(d),e=a.posFromIndex(t+e.length-1)):(t=a.indexFromPos(d),e=a.posFromIndex(t+e.length));c.visualMode&&K(a,!1);a.setCursor(e)}},undo:function(a,b){a.operation(function(){La(a,g.commands.undo,
b.repeat)();a.setCursor(a.getCursor("anchor"))})},redo:function(a,b){La(a,g.commands.redo,b.repeat)()},setRegister:function(a,b,c){c.inputState.registerName=b.selectedCharacter},setMark:function(a,b,c){O(a,c,b.selectedCharacter,a.getCursor())},replace:function(a,b,c){var d=b.selectedCharacter,f=a.getCursor(),e=a.listSelections();if(c.visualMode){f=a.getCursor("start");var k=a.getCursor("end")}else k=a.getLine(f.line),b=f.ch+b.repeat,b>k.length&&(b=k.length),k=l(f.line,b);"\n"==d?(c.visualMode||a.replaceRange("",
f,k),(g.commands.newlineAndIndentContinueComment||g.commands.newlineAndIndent)(a)):(b=a.getRange(f,k),b=b.replace(/[^\n]/g,d),c.visualBlock?(f=Array(a.getOption("tabSize")+1).join(" "),b=a.getSelection(),b=b.replace(/\t/g,f).replace(/[^\n]/g,d).split("\n"),a.replaceSelections(b)):a.replaceRange(b,f,k),c.visualMode?(f=z(e[0].anchor,e[0].head)?e[0].anchor:e[0].head,a.setCursor(f),K(a,!1)):a.setCursor(B(k,0,-1)))},incrementNumberToken:function(a,b){for(var c=a.getCursor(),d=a.getLine(c.line),f=/(-?)(?:(0x)([\da-f]+)|(0b|0|)(\d+))/gi,
e,g,m;null!==(e=f.exec(d))&&!(g=e.index,m=g+e[0].length,c.ch<m););if((b.backtrack||!(m<=c.ch))&&e){d=e[2]||e[4];f=e[3]||e[5];var h=b.increase?1:-1,n={"0b":2,0:8,"":10,"0x":16}[d.toLowerCase()];b=(parseInt(e[1]+f,n)+h*b.repeat).toString(n);e=d?Array(f.length-b.length+1+e[1].length).join("0"):"";b="-"===b.charAt(0)?"-"+d+e+b.substr(1):d+e+b;e=l(c.line,g);m=l(c.line,m);a.replaceRange(b,e,m);a.setCursor(l(c.line,g+b.length-1))}},repeatLastEdit:function(a,b,c){if(c.lastEditInputState){var d=b.repeat;d&&
b.repeatIsExplicit?c.lastEditInputState.repeatOverride=d:d=c.lastEditInputState.repeatOverride||d;db(a,c,d,!1)}},indent:function(a,b){a.indentLine(a.getCursor().line,b.indentRight)},exitInsertMode:Z},Cb={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},mb={bracket:{isComplete:function(a){if(a.nextCh===a.symb){if(a.depth++,1<=a.depth)return!0}else a.nextCh===a.reverseSymb&&a.depth--;return!1}},section:{init:function(a){a.curMoveThrough=
!0;a.symb=(a.forward?"]":"[")===a.symb?"{":"}"},isComplete:function(a){return 0===a.index&&a.nextCh===a.symb}},comment:{isComplete:function(a){var b="*"===a.lastCh&&"/"===a.nextCh;a.lastCh=a.nextCh;return b}},method:{init:function(a){a.symb="m"===a.symb?"{":"}";a.reverseSymb="{"===a.symb?"}":"{"},isComplete:function(a){return a.nextCh===a.symb?!0:!1}},preprocess:{init:function(a){a.index=0},isComplete:function(a){if("#"===a.nextCh){var b=a.lineText.match(/#(\w+)/)[1];if("endif"===b){if(a.forward&&
0===a.depth)return!0;a.depth++}else if("if"===b){if(!a.forward&&0===a.depth)return!0;a.depth--}if("else"===b&&0===a.depth)return!0}return!1}}};ea("pcre",!0,"boolean");Ua.prototype={getQuery:function(){return n.query},setQuery:function(a){n.query=a},getOverlay:function(){return this.searchOverlay},setOverlay:function(a){this.searchOverlay=a},isReversed:function(){return n.isReversed},setReversed:function(a){n.isReversed=a},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(a){this.annotate=
a}};var nb={"\\n":"\n","\\r":"\r","\\t":"\t"},ob={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"\t","\\&":"&"},Bb="(Javascript regexp)",Ya=0,pb=function(){this.buildCommandMap_()};pb.prototype={processCommand:function(a,b,c){var d=this;a.operation(function(){a.curOp.isVimOp=!0;d._processCommand(a,b,c)})},_processCommand:function(a,b,c){var d=a.state.vim,f=n.registerController.getRegister(":"),e=f.toString();d.visualMode&&K(a);d=new g.StringStream(b);f.setText(b);c=c||{};c.input=b;try{this.parseInput_(a,
d,c)}catch(h){throw y(a,h),h;}var k;if(c.commandName){if(k=this.matchCommand_(c.commandName)){var l=k.name;k.excludeFromCommandHistory&&f.setText(e);this.parseCommandArgs_(d,c,k);if("exToKey"==k.type){for(b=0;b<k.toKeys.length;b++)g.Vim.handleKey(a,k.toKeys[b],"mapping");return}if("exToEx"==k.type){this.processCommand(a,k.toInput);return}}}else void 0!==c.line&&(l="move");if(l)try{kb[l](a,c),k&&k.possiblyAsync||!c.callback||c.callback()}catch(h){throw y(a,h),h;}else y(a,'Not an editor command ":'+
b+'"')},parseInput_:function(a,b,c){b.eatWhile(":");b.eat("%")?(c.line=a.firstLine(),c.lineEnd=a.lastLine()):(c.line=this.parseLineSpec_(a,b),void 0!==c.line&&b.eat(",")&&(c.lineEnd=this.parseLineSpec_(a,b)));a=b.match(/^(\w+|!!|@@|[!#&*<=>@~])/);c.commandName=a?a[1]:b.match(/.*/)[0];return c},parseLineSpec_:function(a,b){var c=b.match(/^(\d+)/);if(c)return parseInt(c[1],10)-1;switch(b.next()){case ".":return this.parseLineSpecOffset_(b,a.getCursor().line);case "$":return this.parseLineSpecOffset_(b,
a.lastLine());case "'":c=b.next();a=$a(a,a.state.vim,c);if(!a)throw Error("Mark not set");return this.parseLineSpecOffset_(b,a.line);case "-":case "+":return b.backUp(1),this.parseLineSpecOffset_(b,a.getCursor().line);default:b.backUp(1)}},parseLineSpecOffset_:function(a,b){if(a=a.match(/^([+-])?(\d+)/)){var c=parseInt(a[2],10);b="-"==a[1]?b-c:b+c}return b},parseCommandArgs_:function(a,b,c){a.eol()||(b.argString=a.match(/.*/)[0],a=c.argDelimiter||/\s+/,a=ua(b.argString).split(a),a.length&&a[0]&&(b.args=
a))},matchCommand_:function(a){for(var b=a.length;0<b;b--){var c=a.substring(0,b);if(this.commandMap_[c]&&(c=this.commandMap_[c],0===c.name.indexOf(a)))return c}return null},buildCommandMap_:function(){this.commandMap_={};for(var a=0;a<q.length;a++){var b=q[a];this.commandMap_[b.shortName||b.name]=b}},map:function(a,b,c){if(":"!=a&&":"==a.charAt(0)){if(c)throw Error("Mode not supported for ex mappings");c=a.substring(1);":"!=b&&":"==b.charAt(0)?this.commandMap_[c]={name:c,type:"exToEx",toInput:b.substring(1),
user:!0}:this.commandMap_[c]={name:c,type:"exToKey",toKeys:b,user:!0}}else b=":"!=b&&":"==b.charAt(0)?{keys:a,type:"keyToEx",exArgs:{input:b.substring(1)}}:{keys:a,type:"keyToKey",toKeys:b},c&&(b.context=c),m.unshift(b)},unmap:function(a,b){if(":"!=a&&":"==a.charAt(0)){if(b)throw Error("Mode not supported for ex mappings");a=a.substring(1);if(this.commandMap_[a]&&this.commandMap_[a].user){delete this.commandMap_[a];return}}else for(var c=0;c<m.length;c++)if(a==m[c].keys&&m[c].context===b){m.splice(c,
1);return}throw Error("No such mapping.");}};var kb={colorscheme:function(a,b){!b.args||1>b.args.length?y(a,a.getOption("theme")):a.setOption("theme",b.args[0])},map:function(a,b,c){var d=b.args;!d||2>d.length?a&&y(a,"Invalid mapping: "+b.input):M.map(d[0],d[1],c)},imap:function(a,b){this.map(a,b,"insert")},nmap:function(a,b){this.map(a,b,"normal")},vmap:function(a,b){this.map(a,b,"visual")},unmap:function(a,b,c){var d=b.args;!d||1>d.length?a&&y(a,"No such mapping: "+b.input):M.unmap(d[0],c)},move:function(a,
b){S.processCommand(a,a.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:b.line+1})},set:function(a,b){var c=b.args,d=b.setCfg||{};if(!c||1>c.length)a&&y(a,"Invalid mapping: "+b.input);else{var f=c[0].split("=");c=f[0];f=f[1];var e=!1;if("?"==c.charAt(c.length-1)){if(f)throw Error("Trailing characters: "+b.argString);c=c.substring(0,c.length-1);e=!0}void 0===f&&"no"==c.substring(0,2)&&(c=c.substring(2),f=!1);(b=N[c]&&
"boolean"==N[c].type)&&void 0==f&&(f=!0);!b&&void 0===f||e?(d=U(c,a,d),d instanceof Error?y(a,d.message):!0===d||!1===d?y(a," "+(d?"":"no")+c):y(a,"  "+c+"="+d)):(d=sa(c,f,a,d),d instanceof Error&&y(a,d.message))}},setlocal:function(a,b){b.setCfg={scope:"local"};this.set(a,b)},setglobal:function(a,b){b.setCfg={scope:"global"};this.set(a,b)},registers:function(a,b){var c=b.args;b=n.registerController.registers;var d="----------Registers----------<br><br>";if(c){c=c.join("");for(var f=0;f<c.length;f++)if(g=
c.charAt(f),n.registerController.isValidRegister(g)){var e=b[g]||new I;d+='"'+g+"    "+e.toString()+"<br>"}}else for(var g in b)c=b[g].toString(),c.length&&(d+='"'+g+"    "+c+"<br>");y(a,d)},sort:function(a,b){function c(a,b){if(f){var c=a;a=b;b=c}e&&(a=a.toLowerCase(),b=b.toLowerCase());c=m&&t.exec(a);var d=m&&t.exec(b);if(!c)return a<b?-1:1;c=parseInt((c[1]+c[2]).toLowerCase(),v);d=parseInt((d[1]+d[2]).toLowerCase(),v);return c-d}function d(a,b){if(f){var c=a;a=b;b=c}e&&(a[0]=a[0].toLowerCase(),
b[0]=b[0].toLowerCase());return a[0]<b[0]?-1:1}var f,e,k,m,h,n=function(){if(b.argString){var a=new g.StringStream(b.argString);a.eat("!")&&(f=!0);if(!a.eol()){if(!a.eatSpace())return"Invalid arguments";var c=a.match(/([dinuox]+)?\s*(\/.+\/)?\s*/);if(!c&&!a.eol())return"Invalid arguments";if(c[1]){e=-1!=c[1].indexOf("i");k=-1!=c[1].indexOf("u");a=-1!=c[1].indexOf("d")||-1!=c[1].indexOf("n")&&1;var d=-1!=c[1].indexOf("x")&&1,l=-1!=c[1].indexOf("o")&&1;if(1<a+d+l)return"Invalid arguments";m=a&&"decimal"||
d&&"hex"||l&&"octal"}c[2]&&(h=new RegExp(c[2].substr(1,c[2].length-2),e?"i":""))}}}();if(n)y(a,n+": "+b.argString);else{n=b.line||a.firstLine();var p=b.lineEnd||b.line||a.lastLine();if(n!=p){n=l(n,0);p=l(p,C(a,p));var q=a.getRange(n,p).split("\n"),t=h?h:"decimal"==m?/(-?)([\d]+)/:"hex"==m?/(-?)(?:0x)?([0-9a-f]+)/i:"octal"==m?/([0-7]+)/:null,v="decimal"==m?10:"hex"==m?16:"octal"==m?8:null,r=[],z=[];if(m||h)for(var x=0;x<q.length;x++){var B=h?q[x].match(h):null;B&&""!=B[0]?r.push(B):!h&&t.exec(q[x])?
r.push(q[x]):z.push(q[x])}else z=q;r.sort(h?d:c);if(h)for(x=0;x<r.length;x++)r[x]=r[x].input;else m||z.sort(c);q=f?r.concat(z):z.concat(r);if(k)for(r=q,q=[],x=0;x<r.length;x++){r[x]!=D&&q.push(r[x]);var D=r[x]}a.replaceRange(q.join("\n"),n,p)}}},global:function(a,b){var c=b.argString;if(c){var d=void 0!==b.line?b.line:a.firstLine();b=b.lineEnd||b.line||a.lastLine();var f=Va(c,"/");if(f.length){c=f[0];var e=f.slice(1,f.length).join("/")}if(c)try{Y(a,c,!0,!0)}catch(w){y(a,"Invalid regex: "+c);return}c=
P(a).getQuery();var g=[];for(f="";d<=b;d++)c.test(a.getLine(d))&&(g.push(d+1),f+=a.getLine(d)+"<br>");if(e){var l=0,h=function(){l<g.length&&M.processCommand(a,g[l]+e,{callback:h});l++};h()}else y(a,f)}else y(a,"Regular Expression missing from global")},substitute:function(a,b){if(!a.getSearchCursor)throw Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var c=b.argString,d=c?Va(c,c[0]):[],f="",e,k=!1,m=!1;if(d.length){var h=d[0];U("pcre")&&
""!==h&&(h=(new RegExp(h)).source);f=d[1];h&&"$"===h[h.length-1]&&(h=h.slice(0,h.length-1)+"\\n",f=f?f+"\n":"\n");if(void 0!==f){if(U("pcre")){f=f.replace(/([^\\])&/g,"$1$$&");f=new g.StringStream(f);for(e=[];!f.eol();){for(;f.peek()&&"\\"!=f.peek();)e.push(f.next());c=!1;for(var p in ob)if(f.match(p,!0)){c=!0;e.push(ob[p]);break}c||e.push(f.next())}f=e.join("")}else{p=!1;e=[];for(c=-1;c<f.length;c++){var q=f.charAt(c)||"",x=f.charAt(c+1)||"";nb[q+x]?(e.push(nb[q+x]),c++):p?(e.push(q),p=!1):"\\"===
q?(p=!0,zb.test(x)||"$"===x?e.push("$"):"/"!==x&&"\\"!==x&&e.push("\\")):("$"===q&&e.push("$"),e.push(q),"/"===x&&e.push("\\"))}f=e.join("")}n.lastSubstituteReplacePart=f}e=d[2]?d[2].split(" "):[]}else if(c&&c.length){y(a,"Substitutions should be of the form :s/pattern/replace/");return}if(e){d=e[0];var t=parseInt(e[1]);d&&(-1!=d.indexOf("c")&&(k=!0,d.replace("c","")),-1!=d.indexOf("g")&&(m=!0,d.replace("g","")),h=U("pcre")?h+"/"+d:h.replace(/\//g,"\\/")+"/"+d)}if(h)try{Y(a,h,!0,!0)}catch(v){y(a,
"Invalid regex: "+h);return}f=f||n.lastSubstituteReplacePart;void 0===f?y(a,"No previous substitute regular expression"):(h=P(a).getQuery(),d=void 0!==b.line?b.line:a.getCursor().line,p=b.lineEnd||d,d==a.firstLine()&&p==a.lastLine()&&(p=Infinity),t&&(d=p,p=d+t-1),t=D(a,l(d,0)),t=a.getSearchCursor(h,t),yb(a,k,m,d,p,t,h,f,b.callback))},redo:g.commands.redo,undo:g.commands.undo,write:function(a){g.commands.save?g.commands.save(a):a.save&&a.save()},nohlsearch:function(a){ya(a)},yank:function(a){var b=
x(a.getCursor()).line;a=a.getLine(b);n.registerController.pushText("0","yank",a,!0,!0)},delmarks:function(a,b){if(b.argString&&ua(b.argString))for(var c=a.state.vim,d=new g.StringStream(ua(b.argString));!d.eol();){d.eatSpace();var f=d.pos;if(!d.match(/[a-zA-Z]/,!1)){y(a,"Invalid argument: "+b.argString.substring(f));break}var e=d.next();if(d.match("-",!0)){if(!d.match(/[a-zA-Z]/,!1)){y(a,"Invalid argument: "+b.argString.substring(f));break}var k=d.next();if(/^[a-z]$/.test(e)&&/^[a-z]$/.test(k)||X(e)&&
X(k)){e=e.charCodeAt(0);k=k.charCodeAt(0);if(e>=k){y(a,"Invalid argument: "+b.argString.substring(f));break}for(f=0;f<=k-e;f++){var l=String.fromCharCode(e+f);delete c.marks[l]}}else{y(a,"Invalid argument: "+e+"-");break}}else delete c.marks[e]}else y(a,"Argument required")}},M=new pb;g.keyMap.vim={attach:R,detach:H,call:oa};ea("insertModeEscKeysTimeout",200,"number");g.keyMap["vim-insert"]={fallthrough:["default"],attach:R,detach:H,call:oa};g.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],
attach:R,detach:H,call:oa};Ia();return Ab}()});
