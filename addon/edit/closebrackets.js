'use strict';(function(g){"object"==typeof exports&&"object"==typeof module?g(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],g):g(CodeMirror)})(function(g){function q(b,a){return"pairs"==a&&"string"==typeof b?b:"object"==typeof b&&null!=b[a]?b[a]:w[a]}function x(b){for(var a=0;a<b.length;a++){var c=b.charAt(a),d="'"+c+"'";l[d]||(l[d]=A(c))}}function A(b){return function(a){return B(a,b)}}function t(b){var a=b.state.closeBrackets;return!a||a.override?
a:b.getModeAt(b.getCursor()).closeBrackets||a}function B(b,a){var c=t(b);if(!c||b.getOption("disableInput"))return g.Pass;var d=q(c,"pairs"),f=d.indexOf(a);if(-1==f)return g.Pass;c=q(c,"triples");for(var n=d.charAt(f+1)==a,y=b.listSelections(),l=0==f%2,m,u=0;u<y.length;u++){var r=y[u],e=r.head;var k=b.getRange(e,h(e.line,e.ch+1));if(l&&!r.empty())k="surround";else if(!n&&l||k!=a)if(n&&1<e.ch&&0<=c.indexOf(a)&&b.getRange(h(e.line,e.ch-2),e)==a+a&&(2>=e.ch||b.getRange(h(e.line,e.ch-3),h(e.line,e.ch-
2))!=a))k="addFour";else if(n){r=0==e.ch?" ":b.getRange(h(e.line,e.ch-1),e);if(g.isWordChar(k)||r==a||g.isWordChar(r))return g.Pass;k="both"}else if(l&&(b.getLine(e.line).length==e.ch||C(k,d)||/\s/.test(k)))k="both";else return g.Pass;else k=n&&D(b,e)?"both":0<=c.indexOf(a)&&b.getRange(e,h(e.line,e.ch+3))==a+a+a?"skipThree":"skip";if(!m)m=k;else if(m!=k)return g.Pass}var p=f%2?d.charAt(f-1):a,v=f%2?a:d.charAt(f+1);b.operation(function(){if("skip"==m)b.execCommand("goCharRight");else if("skipThree"==
m)for(var a=0;3>a;a++)b.execCommand("goCharRight");else if("surround"==m){var c=b.getSelections();for(a=0;a<c.length;a++)c[a]=p+c[a]+v;b.replaceSelections(c,"around");c=b.listSelections().slice();for(a=0;a<c.length;a++){var d=c,e=a;var f=c[a];var n=0<g.cmpPos(f.anchor,f.head);f={anchor:new h(f.anchor.line,f.anchor.ch+(n?-1:1)),head:new h(f.head.line,f.head.ch+(n?1:-1))};d[e]=f}b.setSelections(c)}else"both"==m?(b.replaceSelection(p+v,null),b.triggerElectric(p+v),b.execCommand("goCharLeft")):"addFour"==
m&&(b.replaceSelection(p+p+p+p,"before"),b.execCommand("goCharRight"))})}function C(b,a){b=a.lastIndexOf(b);return-1<b&&1==b%2}function z(b,a){b=b.getRange(h(a.line,a.ch-1),h(a.line,a.ch+1));return 2==b.length?b:null}function D(b,a){var c=b.getTokenAt(h(a.line,a.ch+1));return/\bstring/.test(c.type)&&c.start==a.ch&&(0==a.ch||!/\bstring/.test(b.getTokenTypeAt(a)))}var w={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},h=g.Pos;g.defineOption("autoCloseBrackets",!1,function(b,a,c){c&&c!=g.Init&&(b.removeKeyMap(l),
b.state.closeBrackets=null);a&&(x(q(a,"pairs")),b.state.closeBrackets=a,b.addKeyMap(l))});var l={Backspace:function(b){var a=t(b);if(!a||b.getOption("disableInput"))return g.Pass;var c=q(a,"pairs");a=b.listSelections();for(var d=0;d<a.length;d++){if(!a[d].empty())return g.Pass;var f=z(b,a[d].head);if(!f||0!=c.indexOf(f)%2)return g.Pass}for(d=a.length-1;0<=d;d--)c=a[d].head,b.replaceRange("",h(c.line,c.ch-1),h(c.line,c.ch+1),"+delete")},Enter:function(b){var a=t(b);a=a&&q(a,"explode");if(!a||b.getOption("disableInput"))return g.Pass;
for(var c=b.listSelections(),d=0;d<c.length;d++){if(!c[d].empty())return g.Pass;var f=z(b,c[d].head);if(!f||0!=a.indexOf(f)%2)return g.Pass}b.operation(function(){var a=b.lineSeparator()||"\n";b.replaceSelection(a+a,null);b.execCommand("goCharLeft");c=b.listSelections();for(a=0;a<c.length;a++){var d=c[a].head.line;b.indentLine(d,null,!0);b.indentLine(d+1,null,!0)}})}};x(w.pairs+"`")});
