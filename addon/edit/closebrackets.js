'use strict';(function(d){"object"==typeof exports&&"object"==typeof module?d(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],d):d(CodeMirror)})(function(d){function u(a,b){return"pairs"==b&&"string"==typeof a?a:"object"==typeof a&&null!=a[b]?a[b]:B[b]}function C(a){for(var b=0;b<a.length;b++){var c=a.charAt(b),e="'"+c+"'";w[e]||(w[e]=G(c))}}function G(a){return function(b){return H(b,a)}}function x(a){var b=a.state.closeBrackets;return!b||b.override?
b:a.getModeAt(a.getCursor()).closeBrackets||b}function H(a,b){var c=x(a);if(!c||a.getOption("disableInput"))return d.Pass;var e=u(c,"pairs"),g=e.indexOf(b);if(-1==g)return d.Pass;var n=u(c,"closeBefore");c=u(c,"triples");for(var r=e.charAt(g+1)==b,D=a.listSelections(),y=0==g%2,p,z=0;z<D.length;z++){var v=D[z],f=v.head;var k=a.getRange(f,h(f.line,f.ch+1));if(y&&!v.empty())k="surround";else if(!r&&y||k!=b)if(r&&1<f.ch&&0<=c.indexOf(b)&&a.getRange(h(f.line,f.ch-2),f)==b+b){if(2<f.ch&&/\bstring/.test(a.getTokenTypeAt(h(f.line,
f.ch-2))))return d.Pass;k="addFour"}else if(r){v=0==f.ch?" ":a.getRange(h(f.line,f.ch-1),f);if(d.isWordChar(k)||v==b||d.isWordChar(v))return d.Pass;k="both"}else if(y&&(0===k.length||/\s/.test(k)||-1<n.indexOf(k)))k="both";else return d.Pass;else k=r&&I(a,f)?"both":0<=c.indexOf(b)&&a.getRange(f,h(f.line,f.ch+3))==b+b+b?"skipThree":"skip";if(!p)p=k;else if(p!=k)return d.Pass}var t=g%2?e.charAt(g-1):b,A=g%2?b:e.charAt(g+1);a.operation(function(){if("skip"==p)a.execCommand("goCharRight");else if("skipThree"==
p)for(var l=0;3>l;l++)a.execCommand("goCharRight");else if("surround"==p){var m=a.getSelections();for(l=0;l<m.length;l++)m[l]=t+m[l]+A;a.replaceSelections(m,"around");m=a.listSelections().slice();for(l=0;l<m.length;l++){var J=m,K=l;var q=m[l];var E=0<d.cmpPos(q.anchor,q.head);q={anchor:new h(q.anchor.line,q.anchor.ch+(E?-1:1)),head:new h(q.head.line,q.head.ch+(E?1:-1))};J[K]=q}a.setSelections(m)}else"both"==p?(a.replaceSelection(t+A,null),a.triggerElectric(t+A),a.execCommand("goCharLeft")):"addFour"==
p&&(a.replaceSelection(t+t+t+t,"before"),a.execCommand("goCharRight"))})}function F(a,b){a=a.getRange(h(b.line,b.ch-1),h(b.line,b.ch+1));return 2==a.length?a:null}function I(a,b){var c=a.getTokenAt(h(b.line,b.ch+1));return/\bstring/.test(c.type)&&c.start==b.ch&&(0==b.ch||!/\bstring/.test(a.getTokenTypeAt(b)))}var B={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",triples:"",explode:"[]{}"},h=d.Pos;d.defineOption("autoCloseBrackets",!1,function(a,b,c){c&&c!=d.Init&&(a.removeKeyMap(w),a.state.closeBrackets=
null);b&&(C(u(b,"pairs")),a.state.closeBrackets=b,a.addKeyMap(w))});var w={Backspace:function(a){var b=x(a);if(!b||a.getOption("disableInput"))return d.Pass;var c=u(b,"pairs");b=a.listSelections();for(var e=0;e<b.length;e++){if(!b[e].empty())return d.Pass;var g=F(a,b[e].head);if(!g||0!=c.indexOf(g)%2)return d.Pass}for(e=b.length-1;0<=e;e--)c=b[e].head,a.replaceRange("",h(c.line,c.ch-1),h(c.line,c.ch+1),"+delete")},Enter:function(a){var b=x(a);b=b&&u(b,"explode");if(!b||a.getOption("disableInput"))return d.Pass;
for(var c=a.listSelections(),e=0;e<c.length;e++){if(!c[e].empty())return d.Pass;var g=F(a,c[e].head);if(!g||0!=b.indexOf(g)%2)return d.Pass}a.operation(function(){var n=a.lineSeparator()||"\n";a.replaceSelection(n+n,null);a.execCommand("goCharLeft");c=a.listSelections();for(n=0;n<c.length;n++){var r=c[n].head.line;a.indentLine(r,null,!0);a.indentLine(r+1,null,!0)}})}};C(B.pairs+"`")});
