'use strict';(function(d){"object"==typeof exports&&"object"==typeof module?d(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],d):d(CodeMirror)})(function(d){function p(a,c,b){var f=a.getLineHandle(c.line),e=c.ch-1,k=b&&b.afterCursor;null==k&&(k=/(^| )cm-fat-cursor($| )/.test(a.getWrapperElement().className));var h=b&&b.bracketRegex||/[(){}[\]]/;f=!k&&0<=e&&h.test(f.text.charAt(e))&&t[f.text.charAt(e)]||h.test(f.text.charAt(e+1))&&t[f.text.charAt(++e)];
if(!f)return null;k=">"==f.charAt(1)?1:-1;if(b&&b.strict&&0<k!=(e==c.ch))return null;h=a.getTokenTypeAt(m(c.line,e+1));a=u(a,m(c.line,e+(0<k?1:0)),k,h||null,b);return null==a?null:{from:m(c.line,e),to:a&&a.pos,match:a&&a.ch==f.charAt(0),forward:0<k}}function u(a,c,b,f,e){var k=e&&e.maxScanLineLength||1E4,h=e&&e.maxScanLines||1E3,g=[];e=e&&e.bracketRegex||/[(){}[\]]/;h=0<b?Math.min(c.line+h,a.lastLine()+1):Math.max(a.firstLine()-1,c.line-h);for(var d=c.line;d!=h;d+=b){var q=a.getLine(d);if(q){var n=
0<b?0:q.length-1,l=0<b?q.length:-1;if(!(q.length>k))for(d==c.line&&(n=c.ch-(0>b?1:0));n!=l;n+=b){var r=q.charAt(n);if(e.test(r)&&(void 0===f||a.getTokenTypeAt(m(d,n+1))==f)){var p=t[r];if(p&&">"==p.charAt(1)==0<b)g.push(r);else if(g.length)g.pop();else return{pos:m(d,n),ch:r}}}}}return d-b==(0<b?a.lastLine():a.firstLine())?!1:null}function v(a,c,b){for(var f=a.state.matchBrackets.maxHighlightLineLength||1E3,e=[],d=a.listSelections(),h=0;h<d.length;h++){var g=d[h].empty()&&p(a,d[h].head,b);if(g&&a.getLine(g.from.line).length<=
f){var l=g.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket";e.push(a.markText(g.from,m(g.from.line,g.from.ch+1),{className:l}));g.to&&a.getLine(g.to.line).length<=f&&e.push(a.markText(g.to,m(g.to.line,g.to.ch+1),{className:l}))}}if(e.length)if(w&&a.state.focused&&a.focus(),b=function(){a.operation(function(){for(var a=0;a<e.length;a++)e[a].clear()})},c)setTimeout(b,800);else return b}function l(a){a.operation(function(){a.state.matchBrackets.currentlyHighlighted&&(a.state.matchBrackets.currentlyHighlighted(),
a.state.matchBrackets.currentlyHighlighted=null);a.state.matchBrackets.currentlyHighlighted=v(a,!1,a.state.matchBrackets)})}var w=/MSIE \d/.test(navigator.userAgent)&&(null==document.documentMode||8>document.documentMode),m=d.Pos,t={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<","<":">>",">":"<<"};d.defineOption("matchBrackets",!1,function(a,c,b){function f(a){a.state.matchBrackets&&a.state.matchBrackets.currentlyHighlighted&&(a.state.matchBrackets.currentlyHighlighted(),a.state.matchBrackets.currentlyHighlighted=
null)}b&&b!=d.Init&&(a.off("cursorActivity",l),a.off("focus",l),a.off("blur",f),f(a));c&&(a.state.matchBrackets="object"==typeof c?c:{},a.on("cursorActivity",l),a.on("focus",l),a.on("blur",f))});d.defineExtension("matchBrackets",function(){v(this,!0)});d.defineExtension("findMatchingBracket",function(a,c,b){if(b||"boolean"==typeof c)b?(b.strict=c,c=b):c=c?{strict:!0}:null;return p(this,a,c)});d.defineExtension("scanForBracket",function(a,c,b,d){return u(this,a,c,b,d)})});
