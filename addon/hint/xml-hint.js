'use strict';(function(p){"object"==typeof exports&&"object"==typeof module?p(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],p):p(CodeMirror)})(function(p){function t(b,f,c){return c?0<=b.indexOf(f):0==b.lastIndexOf(f,0)}var u=p.Pos;p.registerHelper("hint","xml",function(b,f){var c=f&&f.schemaInfo,l=f&&f.quoteChar||'"';f=f&&f.matchInMiddle;if(c){var h=b.getCursor(),a=b.getTokenAt(h);a.end>h.ch&&(a.end=h.ch,a.string=a.string.slice(0,h.ch-a.start));
var m=p.innerMode(b.getMode(),a.state);if("xml"==m.mode.name){var r=[],n=!1,v=/\btag\b/.test(a.type)&&!/>$/.test(a.string),y=v&&/^\w/.test(a.string),w;if(y){var d=b.getLine(h.line).slice(Math.max(0,a.start-2),a.start);(d=/<\/$/.test(d)?"close":/<$/.test(d)?"open":null)&&(w=a.start-("close"==d?2:1))}else v&&"<"==a.string?d="open":v&&"</"==a.string&&(d="close");if(!v&&!m.state.tagName||d){if(y)var g=a.string;n=d;m=(l=m.state.context)&&c[l.tagName];var k=l?m&&m.children:c["!top"];if(k&&"close"!=d)for(b=
0;b<k.length;++b)g&&!t(k[b],g,f)||r.push("<"+k[b]);else if("close"!=d)for(var e in c)!c.hasOwnProperty(e)||"!top"==e||"!attrs"==e||g&&!t(e,g,f)||r.push("<"+e);l&&(!g||"close"==d&&t(l.tagName,g,f))&&r.push("</"+l.tagName+">")}else{e=(m=c[m.state.tagName])&&m.attrs;c=c["!attrs"];if(!e&&!c)return;if(!e)e=c;else if(c){d={};for(var q in c)c.hasOwnProperty(q)&&(d[q]=c[q]);for(q in e)e.hasOwnProperty(q)&&(d[q]=e[q]);e=d}if("string"==a.type||"="==a.string){d=b.getRange(u(h.line,Math.max(0,h.ch-60)),u(h.line,
"string"==a.type?a.start:a.end));c=d.match(/([^\s\u00a0=<>"']+)=$/);if(!c||!e.hasOwnProperty(c[1])||!(k=e[c[1]]))return;"function"==typeof k&&(k=k.call(this,b));"string"==a.type&&(g=a.string,n=0,/['"]/.test(a.string.charAt(0))&&(l=a.string.charAt(0),g=a.string.slice(1),n++),b=a.string.length,/['"]/.test(a.string.charAt(b-1))&&(l=a.string.charAt(b-1),g=a.string.substr(n,b-2)),n=!0);for(b=0;b<k.length;++b)g&&!t(k[b],g,f)||r.push(l+k[b]+l)}else{"attribute"==a.type&&(g=a.string,n=!0);for(var x in e)!e.hasOwnProperty(x)||
g&&!t(x,g,f)||r.push(x)}}return{list:r,from:n?u(h.line,null==w?a.start:w):h,to:n?u(h.line,a.end):h}}}})});
