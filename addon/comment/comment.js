'use strict';(function(h){"object"==typeof exports&&"object"==typeof module?h(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],h):h(CodeMirror)})(function(h){function w(b){b=b.search(q);return-1==b?0:b}function E(b,c,a){return/\bstring\b/.test(b.getTokenTypeAt(k(c.line,0)))&&!/^[\'\"`]/.test(a)}function C(b,c){var a=b.getMode();return!1!==a.useInnerComments&&a.innerMode?b.getModeAt(c):a}var A={},q=/[^\s\u00a0]/,k=h.Pos;h.commands.toggleComment=
function(b){b.toggleComment()};h.defineExtension("toggleComment",function(b){b||(b=A);for(var c=Infinity,a=this.listSelections(),d=null,e=a.length-1;0<=e;e--){var f=a[e].from(),g=a[e].to();f.line>=c||(g.line>=c&&(g=k(c,0)),c=f.line,null==d?this.uncomment(f,g,b)?d="un":(this.lineComment(f,g,b),d="line"):"un"==d?this.uncomment(f,g,b):this.lineComment(f,g,b))}});h.defineExtension("lineComment",function(b,c,a){a||(a=A);var d=this,e=C(d,b),f=d.getLine(b.line);if(null!=f&&!E(d,b,f)){var g=a.lineComment||
e.lineComment;if(g){var m=Math.min(0!=c.ch||c.line==b.line?c.line+1:c.line,d.lastLine()+1),h=null==a.padding?" ":a.padding,l=a.commentBlankLines||b.line==c.line;d.operation(function(){if(a.indent){for(var c=null,f=b.line;f<m;++f){var e=d.getLine(f),e=e.slice(0,w(e));if(null==c||c.length>e.length)c=e}for(f=b.line;f<m;++f){var e=d.getLine(f),n=c.length;if(l||q.test(e))e.slice(0,n)!=c&&(n=w(e)),d.replaceRange(c+g+h,k(f,0),k(f,n))}}else for(f=b.line;f<m;++f)(l||q.test(d.getLine(f)))&&d.replaceRange(g+
h,k(f,0))})}else if(a.blockCommentStart||e.blockCommentStart)a.fullLines=!0,d.blockComment(b,c,a)}});h.defineExtension("blockComment",function(b,c,a){a||(a=A);var d=this,e=C(d,b),f=a.blockCommentStart||e.blockCommentStart,g=a.blockCommentEnd||e.blockCommentEnd;if(!f||!g)(a.lineComment||e.lineComment)&&0!=a.fullLines&&d.lineComment(b,c,a);else if(!/\bcomment\b/.test(d.getTokenTypeAt(k(b.line,0)))){var m=Math.min(c.line,d.lastLine());m!=b.line&&0==c.ch&&q.test(d.getLine(m))&&--m;var h=null==a.padding?
" ":a.padding;b.line>m||d.operation(function(){if(0!=a.fullLines){var l=q.test(d.getLine(m));d.replaceRange(h+g,k(m));d.replaceRange(f+h,k(b.line,0));var x=a.blockCommentLead||e.blockCommentLead;if(null!=x)for(var p=b.line+1;p<=m;++p)(p!=m||l)&&d.replaceRange(x+h,k(p,0))}else d.replaceRange(g,c),d.replaceRange(f,b)})}});h.defineExtension("uncomment",function(b,c,a){a||(a=A);var d=this,e=C(d,b),f=Math.min(0!=c.ch||c.line==b.line?c.line:c.line-1,d.lastLine()),g=Math.min(b.line,f),h=a.lineComment||e.lineComment,
w=[],l=null==a.padding?" ":a.padding,x;a:if(h){for(var p=g;p<=f;++p){var B=d.getLine(p),n=B.indexOf(h);-1<n&&!/comment/.test(d.getTokenTypeAt(k(p,n+1)))&&(n=-1);if(-1==n&&q.test(B))break a;if(-1<n&&q.test(B.slice(0,n)))break a;w.push(B)}d.operation(function(){for(var a=g;a<=f;++a){var b=w[a-g],c=b.indexOf(h),e=c+h.length;0>c||(b.slice(e,e+l.length)==l&&(e+=l.length),x=!0,d.replaceRange("",k(a,c),k(a,e)))}});if(x)return!0}var t=a.blockCommentStart||e.blockCommentStart,u=a.blockCommentEnd||e.blockCommentEnd;
if(!t||!u)return!1;var D=a.blockCommentLead||e.blockCommentLead,y=d.getLine(g),z=y.indexOf(t);if(-1==z)return!1;var v=f==g?y:d.getLine(f),r=v.indexOf(u,f==g?z+t.length:0);-1==r&&g!=f&&(v=d.getLine(--f),r=v.indexOf(u));if(-1==r||!/comment/.test(d.getTokenTypeAt(k(g,z+1)))||!/comment/.test(d.getTokenTypeAt(k(f,r+1))))return!1;e=y.lastIndexOf(t,b.ch);a=-1==e?-1:y.slice(0,b.ch).indexOf(u,e+t.length);if(-1!=e&&-1!=a&&a+u.length!=b.ch)return!1;a=v.indexOf(u,c.ch);b=v.slice(c.ch).lastIndexOf(t,a-c.ch);e=
-1==a||-1==b?-1:c.ch+b;if(-1!=a&&-1!=e&&e!=c.ch)return!1;d.operation(function(){d.replaceRange("",k(f,r-(l&&v.slice(r-l.length,r)==l?l.length:0)),k(f,r+u.length));var a=z+t.length;l&&y.slice(a,a+l.length)==l&&(a+=l.length);d.replaceRange("",k(g,z),k(g,a));if(D)for(a=g+1;a<=f;++a){var b=d.getLine(a),c=b.indexOf(D);if(-1!=c&&!q.test(b.slice(0,c))){var e=c+D.length;l&&b.slice(e,e+l.length)==l&&(e+=l.length);d.replaceRange("",k(a,c),k(a,e))}}});return!0})});
